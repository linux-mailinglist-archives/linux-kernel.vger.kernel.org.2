Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 7F5E5453420
	for <lists+linux-kernel@lfdr.de>; Tue, 16 Nov 2021 15:26:15 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S237419AbhKPO3D (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Tue, 16 Nov 2021 09:29:03 -0500
Received: from mga06.intel.com ([134.134.136.31]:30462 "EHLO mga06.intel.com"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S230453AbhKPO3A (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Tue, 16 Nov 2021 09:29:00 -0500
X-IronPort-AV: E=McAfee;i="6200,9189,10169"; a="294517240"
X-IronPort-AV: E=Sophos;i="5.87,239,1631602800"; 
   d="scan'208";a="294517240"
Received: from orsmga007.jf.intel.com ([10.7.209.58])
  by orsmga104.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384; 16 Nov 2021 06:26:02 -0800
X-IronPort-AV: E=Sophos;i="5.87,239,1631602800"; 
   d="scan'208";a="494472564"
Received: from rli9-dbox.sh.intel.com (HELO rli9-dbox) ([10.239.159.142])
  by orsmga007-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384; 16 Nov 2021 06:26:00 -0800
Date:   Tue, 16 Nov 2021 22:26:57 +0800
From:   Philip Li <philip.li@intel.com>
To:     Hans de Goede <hdegoede@redhat.com>
Cc:     kernel test robot <lkp@intel.com>,
        Nathan Chancellor <nathan@kernel.org>, llvm@lists.linux.dev,
        kbuild-all@lists.01.org, linux-kernel@vger.kernel.org,
        Nick Desaulniers <ndesaulniers@google.com>
Subject: Re: [kbuild-all] Re: drivers/platform/x86/thinkpad_acpi.c:4475:35:
 error: unused variable 'fwbug_cards_ids'
Message-ID: <YZO/sZfx1k5eRdUx@rli9-dbox>
References: <202111141153.mtggZgGq-lkp@intel.com>
 <009706db-230a-1e49-0a42-447a0ff97fbb@redhat.com>
 <YZOlZPna3djQPYsp@rli9-dbox>
 <de7f0b11-373b-6d7b-ca34-20d2162a7f70@redhat.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <de7f0b11-373b-6d7b-ca34-20d2162a7f70@redhat.com>
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Tue, Nov 16, 2021 at 01:40:50PM +0100, Hans de Goede wrote:
> Hi,
> 
> On 11/16/21 13:34, Philip Li wrote:
> > On Tue, Nov 16, 2021 at 11:26:48AM +0100, Hans de Goede wrote:
> >> Hi,
> >>
> >> On 11/14/21 04:10, kernel test robot wrote:
> >>> tree:   https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git master
> >>> head:   c8c109546a19613d323a319d0c921cb1f317e629
> >>> commit: fd96e35ea7b95f1e216277805be89d66e4ae962d platform/x86: thinkpad_acpi: Fix bitwise vs. logical warning
> >>> date:   4 weeks ago
> >>> config: i386-buildonly-randconfig-r005-20211114 (attached as .config)
> >>> compiler: clang version 14.0.0 (https://github.com/llvm/llvm-project c3dddeeafb529e769cde87bd29ef6271ac6bfa5c)
> >>> reproduce (this is a W=1 build):
> >>>         wget https://raw.githubusercontent.com/intel/lkp-tests/master/sbin/make.cross -O ~/bin/make.cross
> >>>         chmod +x ~/bin/make.cross
> >>>         # https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=fd96e35ea7b95f1e216277805be89d66e4ae962d
> >>>         git remote add linus https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git
> >>>         git fetch --no-tags linus master
> >>>         git checkout fd96e35ea7b95f1e216277805be89d66e4ae962d
> >>>         # save the attached .config to linux build tree
> >>>         COMPILER_INSTALL_PATH=$HOME/0day COMPILER=clang make.cross W=1 ARCH=i386 
> >>>
> >>> If you fix the issue, kindly add following tag as appropriate
> >>> Reported-by: kernel test robot <lkp@intel.com>
> >>>
> >>> All errors (new ones prefixed by >>):
> >>>
> >>>>> drivers/platform/x86/thinkpad_acpi.c:4475:35: error: unused variable 'fwbug_cards_ids' [-Werror,-Wunused-const-variable]
> >>>    static const struct pci_device_id fwbug_cards_ids[] __initconst = {
> >>>                                      ^
> >>>    1 error generated.
> >>
> >> So this *again* has absolutely nothing to do with the:
> >>
> >> "platform/x86: thinkpad_acpi: Fix bitwise vs. logical warning"
> >>
> >> commit, the problem is that:
> >>
> >> 1. the .config does not have CONFIG_PCI set; combined with:
> >> 2. include/pci.h using a #define instead of a
> >>    static inline for pci_dev_present() when this is the case
> >> 3. This is a clang WERROR build
> >>
> >> I'll submit a fix for 2. upstream which should also fix
> >> similar errors in a lot of other drivers.
> >>
> >> Again I must say that as a maintainer I'm unhappy about the amount
> >> of noise being generated by clang WERROR builds here though,
> >> is it really necessary for the kernel test robot to do builds
> >> of this type ?
> > Sorry Hans for the noise, we will look into this to consider the
> > solution. And want to consult, do you specially have concern about
> > -Wunused-const-variable or all W=1 related build issues?
> 
> Thank you.
> 
> W=1 is know to cause many many warnings, so to me it seems that
> combining W=1 with CONFIG_WERROR=1 is a bad idea.
> 
> If it would be possible to avoid that combination then that would
> be great.
thanks, got it, we will get this fixed to set WERROR=n for
all the randconfigs we use.

> 
> Regards,
> 
> Hans
> 
> 
> 
> 
> 
> 
> >>> vim +/fwbug_cards_ids +4475 drivers/platform/x86/thinkpad_acpi.c
> >>>
> >>> f7db839fccf087 Jiaxun Yang 2019-03-07  4474  
> >>> f7db839fccf087 Jiaxun Yang 2019-03-07 @4475  static const struct pci_device_id fwbug_cards_ids[] __initconst = {
> >>> f7db839fccf087 Jiaxun Yang 2019-03-07  4476  	{ PCI_DEVICE(PCI_VENDOR_ID_INTEL, 0x24F3) },
> >>> f7db839fccf087 Jiaxun Yang 2019-03-07  4477  	{ PCI_DEVICE(PCI_VENDOR_ID_INTEL, 0x24FD) },
> >>> f7db839fccf087 Jiaxun Yang 2019-03-07  4478  	{ PCI_DEVICE(PCI_VENDOR_ID_INTEL, 0x2526) },
> >>> f7db839fccf087 Jiaxun Yang 2019-03-07  4479  	{}
> >>> f7db839fccf087 Jiaxun Yang 2019-03-07  4480  };
> >>> f7db839fccf087 Jiaxun Yang 2019-03-07  4481  
> >>> f7db839fccf087 Jiaxun Yang 2019-03-07  4482  
> >>>
> >>> :::::: The code at line 4475 was first introduced by commit
> >>> :::::: f7db839fccf087664e5587966220821289b6a9cb platform/x86: thinkpad_acpi: Disable Bluetooth for some machines
> >>>
> >>> :::::: TO: Jiaxun Yang <jiaxun.yang@flygoat.com>
> >>> :::::: CC: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
> >>>
> >>> ---
> >>> 0-DAY CI Kernel Test Service, Intel Corporation
> >>> https://lists.01.org/hyperkitty/list/kbuild-all@lists.01.org
> >>>
> >> _______________________________________________
> >> kbuild-all mailing list -- kbuild-all@lists.01.org
> >> To unsubscribe send an email to kbuild-all-leave@lists.01.org
> > 
> 
