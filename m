Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id A807532F969
	for <lists+linux-kernel@lfdr.de>; Sat,  6 Mar 2021 11:41:30 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S230149AbhCFKk5 (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Sat, 6 Mar 2021 05:40:57 -0500
Received: from conssluserg-01.nifty.com ([210.131.2.80]:38849 "EHLO
        conssluserg-01.nifty.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S230141AbhCFKkz (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Sat, 6 Mar 2021 05:40:55 -0500
Received: from mail-pf1-f179.google.com (mail-pf1-f179.google.com [209.85.210.179]) (authenticated)
        by conssluserg-01.nifty.com with ESMTP id 126AedS4021724
        for <linux-kernel@vger.kernel.org>; Sat, 6 Mar 2021 19:40:39 +0900
DKIM-Filter: OpenDKIM Filter v2.10.3 conssluserg-01.nifty.com 126AedS4021724
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=nifty.com;
        s=dec2015msa; t=1615027239;
        bh=BplUrRiYbi4amxPmnKQ9mC3hGG6hKszQ8eV6smsKPzg=;
        h=References:In-Reply-To:From:Date:Subject:To:Cc:From;
        b=0kqVlP/3ZzSDgGVOx8flG0dnvpeIERliGX6g1KJt05JbryMs60Co70o/w6CiK0nmu
         Z0hDA2/7G7mLVW1wYdTz+UB/C+BSYZUEmpBtfl3842HQVg8khx/ncFixUlCh13AZZJ
         ATc640oIGXdFXQVE+dmmcRN/Id7zJNPtWgiPGnj1vi8oUNFxvgljT5qvdytKneZUqQ
         yGnkDEDYHC8kU22NC0cHaYVRjcMAb1q+Q9B98PYn43mI1BWunmxZQwHlvDjlV8X+AH
         k922+aVqbXnIqrkoJ3PE5fv86ukSZNttEAAl6i/oxXjvEHATIKzWTcZ8zTx+nZfl8X
         VVXSRi10dazLg==
X-Nifty-SrcIP: [209.85.210.179]
Received: by mail-pf1-f179.google.com with SMTP id m6so3994088pfk.1
        for <linux-kernel@vger.kernel.org>; Sat, 06 Mar 2021 02:40:39 -0800 (PST)
X-Gm-Message-State: AOAM5321IabHmdz4DTbXVC6pP5igmpUihaTxEpfeoTC7z7oACg3ympjl
        h+CBLvOmBsGekd+NjmEW0HRKi9UJRtmvcTD4QSg=
X-Google-Smtp-Source: ABdhPJyA2J+2Pr4VifpdvfaC20PwT1z64SKVBUnvGgby79es8lTfZOuV9hXhdo7FzFjw5fjD6I7L7+6XlcNapoFGhCU=
X-Received: by 2002:a65:41c6:: with SMTP id b6mr12172438pgq.7.1615027238655;
 Sat, 06 Mar 2021 02:40:38 -0800 (PST)
MIME-Version: 1.0
References: <20210303104314.24121-1-jslaby@suse.cz>
In-Reply-To: <20210303104314.24121-1-jslaby@suse.cz>
From:   Masahiro Yamada <masahiroy@kernel.org>
Date:   Sat, 6 Mar 2021 19:40:01 +0900
X-Gmail-Original-Message-ID: <CAK7LNATWcu1p=F+zHCTdGK2ZRMjKKOS4DvAWrOnRjc_iKTCKmA@mail.gmail.com>
Message-ID: <CAK7LNATWcu1p=F+zHCTdGK2ZRMjKKOS4DvAWrOnRjc_iKTCKmA@mail.gmail.com>
Subject: Re: [PATCH] kbuild: dummy-tools, fix inverted tests for gcc
To:     Jiri Slaby <jslaby@suse.cz>
Cc:     Linux Kernel Mailing List <linux-kernel@vger.kernel.org>
Content-Type: text/plain; charset="UTF-8"
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Wed, Mar 3, 2021 at 7:43 PM Jiri Slaby <jslaby@suse.cz> wrote:
>
> There is a test in Kconfig which takes inverted value of a compiler
> check:
> * config CC_HAS_INT128
>         def_bool !$(cc-option,$(m64-flag) -D__SIZEOF_INT128__=0)
>
> This results in CC_HAS_INT128 not being in super-config generated by
> dummy-tools. So take this into account in the gcc script.
>
> Signed-off-by: Jiri Slaby <jslaby@suse.cz>
> Cc: Masahiro Yamada <masahiroy@kernel.org>
> ---


Applied to linux-kbuild/fixes.
Thanks.


We could fix init/Kconfig to use the positive logic as follows,
but I guess (hope) this conditional will go away
when we raise the GCC min version next time.
So, I am fine with fixing this in dummy-tools.




diff --git a/init/Kconfig b/init/Kconfig
index 22946fe5ded9..502594a78282 100644
--- a/init/Kconfig
+++ b/init/Kconfig
@@ -849,7 +849,7 @@ config ARCH_WANT_BATCHED_UNMAP_TLB_FLUSH
        bool

 config CC_HAS_INT128
-       def_bool !$(cc-option,$(m64-flag) -D__SIZEOF_INT128__=0) && 64BIT
+       def_bool $(success,echo '__int128 x;' | $(CC) $(CLANG_FLAGS)
-x c - -c -o /dev/null) && 64BIT

 #
 # For architectures that know their GCC __int128 support is sound





-- 
Best Regards
Masahiro Yamada
