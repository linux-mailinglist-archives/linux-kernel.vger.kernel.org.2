Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id D15BB458C5B
	for <lists+linux-kernel@lfdr.de>; Mon, 22 Nov 2021 11:34:06 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S239279AbhKVKhF (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Mon, 22 Nov 2021 05:37:05 -0500
Received: from mail.kernel.org ([198.145.29.99]:60262 "EHLO mail.kernel.org"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S239045AbhKVKhE (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Mon, 22 Nov 2021 05:37:04 -0500
Received: from disco-boy.misterjones.org (disco-boy.misterjones.org [51.254.78.96])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by mail.kernel.org (Postfix) with ESMTPSA id E2DAA60F70;
        Mon, 22 Nov 2021 10:33:57 +0000 (UTC)
Received: from sofa.misterjones.org ([185.219.108.64] helo=why.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.94.2)
        (envelope-from <maz@kernel.org>)
        id 1mp6e3-0071rV-Ph; Mon, 22 Nov 2021 10:33:56 +0000
Date:   Mon, 22 Nov 2021 10:33:55 +0000
Message-ID: <874k847a3w.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     John Crispin <john@phrozen.org>
Cc:     Sander Vanheule <sander@svanheule.net>,
        Rob Herring <robh+dt@kernel.org>,
        Birger Koblitz <mail@birger-koblitz.de>,
        Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>,
        Bjorn Helgaas <bhelgaas@google.com>,
        Bert Vermeulen <bert@biot.com>,
        Thomas Gleixner <tglx@linutronix.de>,
        linux-kernel@vger.kernel.org, devicetree@vger.kernel.org,
        Frank Rowand <frowand.list@gmail.com>
Subject: Re: realtek,rtl-intc IRQ mapping broken on 5.16-rc1
In-Reply-To: <9c169aad-3c7b-2ffb-90a2-1ca791a3f411@phrozen.org>
References: <bbe5506a2458b2d6049bd22a5fda77ae6175ddec.camel@svanheule.net>
        <87ilwp6zm6.wl-maz@kernel.org>
        <fdfe6615a0ec0d4a770b04a437922956e8586078.camel@svanheule.net>
        <877dd46w2b.wl-maz@kernel.org>
        <763394a6e5c83006eb4628a9d0242b7eb04b889d.camel@svanheule.net>
        <9c169aad-3c7b-2ffb-90a2-1ca791a3f411@phrozen.org>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/27.1
 (x86_64-pc-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: john@phrozen.org, sander@svanheule.net, robh+dt@kernel.org, mail@birger-koblitz.de, lorenzo.pieralisi@arm.com, bhelgaas@google.com, bert@biot.com, tglx@linutronix.de, linux-kernel@vger.kernel.org, devicetree@vger.kernel.org, frowand.list@gmail.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Sun, 21 Nov 2021 21:11:15 +0000,
John Crispin <john@phrozen.org> wrote:
> 
> 
> 
> On 21.11.21 21:33, Sander Vanheule wrote:
> > Alternatively, a second compatible could perhaps be introduced and the current
> > one would be deprecated, using (2) to prevent breaking 5.16+ kernels. I don't
> > think that's really worth the effort though.
> > 
> > Best,
> 
> Hey,
> 
> I think that what Marc proposed as (1) is the clean solution. We want
> to describe the HW as it exists. Yes we have zero docs, and the RLT
> 2.6 sdk kernel is a pain to extract info from, yet we should move fwd
> with a clean implementation.
> 
> breaking pseudo owrt dts ABI is imho acceptable. owrt users are well
> able to reflash their units from uboot, they are at the end flying
> without wings on bleeding edge. asking for some backward compat for a
> de-facto broken dts mapping of the HW is imho a no-go.

I'm afraid this ship has sailed a long time ago. As I found out, there
are a number of drivers having perpetuated the same horror:

+       "CBEA,platform-spider-pic",
+       "sti,platform-spider-pic",
+       "realtek,rtl-intc",
+       "fsl,ls1021a-extirq",
+       "fsl,ls1043a-extirq",
+       "fsl,ls1088a-extirq",
+       "renesas,rza1-irqc",

We can't just change the bindings for those. For the first two, the DT
is provided by the FW. For the others, there are numerous systems in
the wild, and we can't break them (DT and kernel must be upgradable
independently).

I've posted a quirk patch[1], and I'd appreciate any feedback on
whether it fixes your problem.

Thanks,

	M.

[1] https://lore.kernel.org/r/20211122103032.517923-1-maz@kernel.org

-- 
Without deviation from the norm, progress is not possible.
