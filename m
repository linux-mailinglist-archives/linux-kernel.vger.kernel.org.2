Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 8D5C637077E
	for <lists+linux-kernel@lfdr.de>; Sat,  1 May 2021 16:01:42 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S232220AbhEAOCa (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Sat, 1 May 2021 10:02:30 -0400
Received: from mout.gmx.net ([212.227.17.20]:52391 "EHLO mout.gmx.net"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S232136AbhEAOC2 (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Sat, 1 May 2021 10:02:28 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=gmx.net;
        s=badeba3b8450; t=1619877686;
        bh=T0Fd1bzwcjESFjSMFc7M/35dAUEogjYlT/6DN2d89Vs=;
        h=X-UI-Sender-Class:From:To:Cc:Subject:Date:In-Reply-To:References;
        b=KDzslDkqJFJBL33wfwg3hQfu918SHPcViLDdoMlZHYa6dy5NfvLBTRoHoj9QsnlS6
         7BjnBhIhLf7yq+/Ff/KOQh5wAcH4iWLPVXMYkPSaQDN/NE0R+u5/VBoRJZYGkWxCO5
         r0ETN0LQHupyWUdRAECUgPVIFM2PWJhA1/yhmSyo=
X-UI-Sender-Class: 01bb95c1-4bf8-414a-932a-4f6e2808ef9c
Received: from Venus.fritz.box ([78.42.220.31]) by mail.gmx.net (mrgmx105
 [212.227.17.168]) with ESMTPSA (Nemesis) id 1Mlw3X-1lCt1B09AJ-00iyze; Sat, 01
 May 2021 16:01:26 +0200
From:   Lino Sanfilippo <LinoSanfilippo@gmx.de>
To:     peterhuewe@gmx.de, jarkko@kernel.org, jgg@ziepe.ca
Cc:     stefanb@linux.vnet.ibm.com, James.Bottomley@hansenpartnership.com,
        keescook@chromium.org, jsnitsel@redhat.com, ml.linux@elloe.vision,
        linux-integrity@vger.kernel.org, linux-kernel@vger.kernel.org,
        LinoSanfilippo@gmx.de
Subject: [PATCH v3 2/4] tpm: Simplify locality handling
Date:   Sat,  1 May 2021 15:57:25 +0200
Message-Id: <20210501135727.17747-3-LinoSanfilippo@gmx.de>
X-Mailer: git-send-email 2.31.1
In-Reply-To: <20210501135727.17747-1-LinoSanfilippo@gmx.de>
References: <20210501135727.17747-1-LinoSanfilippo@gmx.de>
MIME-Version: 1.0
Content-Transfer-Encoding: base64
X-Provags-ID: V03:K1:OvJNB7A4vqxmwwT+wqDxULsbp48SDBs1Byb6p5U0IpGzb/5vC3C
 462n/fSPbZKIL9NdmCy5li4QbQfp6nQifBfJPO2OhZdpVmzJiB4CmIha2PlN8RrZHbM+OJJ
 JwHA/K1WsFdB20a6qCdJV9wu0MhPi6v16HZSqpBXlACqaU+wUBxSqy6qeGP/foM95N5hrlu
 6Bi/3mNQBXfB/1r+BAAXA==
X-Spam-Flag: NO
X-UI-Out-Filterresults: notjunk:1;V03:K0:czHwvHrGdNg=:761gljfEtc4Bpa1OQfFZ65
 n4EiFkRYP7DhlWakUatNxx+KOxlaLABgBoImASRoikSH5mMiafIwUKY5olPciircUIwPc7mbK
 eFxwXmqiI1M8/y9AUUmctMBnPP7zP43hcFx1wKBQ5CtYiDcioG3Wd+wnWW9FDQ//6GSzT9wTu
 VArnB4QP5ftPyKxzNVX1983TrSahW73Atl3IMV7vBlDvXZEP4GbJVFfDO7G0y1wVP3dQyF19F
 uzxBFg18e/gLsLFdmIGFIRtoMW3b3ectxyfyXn/7+34ZwMvDNyPPJhCdY0iqFI3DNXjOagk4i
 AlTUnXZ5aAQXizWhU3F6zxSoGKgHP8QX0f9qCnU5wMi+ze7I/QpAKIu6m+inP7u+CbLpQBQWF
 S8RGQUug/PzsQwunhDivaIxSYe/otn9AX/UStHSrdz2nEsJ/KBilKtu0rHVWwIuDOWjZbJN8H
 268bPTOCrpBPBe3wDMlhpB+hJauXcQssNWIPvg1F2AT/Nc9oJ/s8Nr0bFqswbt4JDydGytG92
 TVYOad+7i6dw8uaoNXl9/QAjcNQEMeVy305dHnc+EiCDOnbe9RGgXg9sGVbVaxroIZB44UqzJ
 4gPbzMQYdcFATFx5B9Ipiym/WcrsINlGkR1I9Q8sBT7/3Aq5oslMBwTBCaiq9hkB14Nt6VmXf
 aK6+KlQNlqh6BqlYrcauByWSd5yyTvY/0z2rOjfPf/d7vul1RLpDrLQ1bEKJA0HomeQSqRSXv
 Ozxi+1Ag0S0YOtWqkv+i+c1HEjYYyJk+08OuTPVLzCB0LRAibi34a4/Tn+9jvOBAsst6ySdda
 gpmDZWqkZlb30PHPwhIF9D3fSKwCVTetnvSmMXdHJqVSr8WPDW99F5aaQcHP103rQay2iHRsm
 o0M80UYjeBLwybvochPcKm0ACJ1S1eBe5ZtHWmf+Kkw+3wg8fAWudqt5b0oQU+ZPSSp8+wcwu
 5Mu/ln1+4MJ01+Hdck2MiAUr5Ntgn+tqKcySpnio76o7UfQfqfYH6Hy6sBJX3qDzePBrv42KC
 9gBrICozavneJYDvDriU9FS8/74ply0/A4vF2p4/pqBUtoQ9Tt/rVzXasuxdk0GVnT3f2YIl1
 o4Nxtmh1DvfxA/O1+QHP50J6XdmbKVIVbiZemqAoVk4Uvy61U9S23UX/fHBO5WoT3JQQ8is6X
 lQ/hK4Qq1E/6F2H+K8//KJjr3lWFagLl9nAex/doQQJXU2lc1O6miesC8Bkkcn+IxCPOOIC8/
 Rw6cbLC2DRRzLNC3V
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Q3VycmVudGx5IHRoZSBUUE0gKGRlZmF1bHQpIGxvY2FsaXR5IGlzIGNsYWltZWQgYW5kIHJlbGVh
c2VkIGZvciBlYWNoCmFjY2VzcyB0byB0aGUgVFBNIHJlZ2lzdGVycyB3aGljaCByZXF1aXJlIGEg
Y2xhaW1lZCBsb2NhbGl0eS4gVGhpcyByZXN1bHRzCmluIGxvY2FsaXR5IGNsYWltL3JlbGVhc2Ug
Y29tYm9zIGF0IHZhcmlvdXMgY29kZSBwbGFjZXMuIEZvciBpbnRlcnJ1cHQKaGFuZGxpbmcgd2Ug
YWxzbyBuZWVkIHN1Y2ggYSBjb21ibyBpbiB0aGUgaW50ZXJydXB0IGhhbmRsZXIgKGZvciBjbGVh
cmluZwp0aGUgaW50ZXJydXB0cykgd2hpY2ggbWFrZXMgdGhlIGxvY2FsaXR5IGhhbmRsaW5nIGV2
ZW4gbW9yZSBjb21wbGljYXRlZApzaW5jZSBub3cgd2UgYWxzbyBoYXZlIHRvIHN5bmNocm9uaXpl
IGNvbmN1cnJlbnQgYWNjZXNzZXMgaW4gcHJvY2VzcyBhbmQgaW4KaW50ZXJydXB0IGNvbnRleHQu
CgpTaW5jZSBjdXJyZW50bHkgdGhlIGRyaXZlciB1c2VzIG9ubHkgb25lIGxvY2FsaXR5IGFueXdh
eSwgYXZvaWQgdGhlCmluY3JlYXNpbmcgY29tcGxleGl0eSBieSBjbGFpbWluZyBpdCBvbmNlIGF0
IGRyaXZlciBzdGFydHVwIGFuZCBvbmx5CnJlbGVhc2luZyBpdCBhdCBkcml2ZXIgc2h1dGRvd24u
CgpEdWUgdG8gdGhlIHNpbXBsaWZpY2F0aW9ucyB0aGUgZnVuY3Rpb25zIHRwbV9yZXF1ZXN0X2xv
Y2FsaXR5KCkgYW5kCnRwbV9yZWxpbnF1aXNoX2xvY2FsaXR5KCkgYXJlIG5vdCBuZWVkZWQgYW55
IG1vcmUgYW4gY2FuIGJlIHJlbW92ZWQuCgpBcyBhIHNpZGUtZWZmZWN0IHRoZXNlIG1vZGlmaWNh
dGlvbnMgZml4IGEgYnVnIHdoaWNoIHJlc3VsdHMgaW4gdGhlCmZvbGxvd2luZyB3YXJuaW5nIHdo
ZW4gdXNpbmcgVFBNIDI6CgpUUE0gcmV0dXJuZWQgaW52YWxpZCBzdGF0dXMKV0FSTklORzogQ1BV
OiAwIFBJRDogODc0IGF0IGRyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmM6MjQ5IHRwbV90
aXNfc3RhdHVzKzB4YmMvMHhjOCBbdHBtX3Rpc19jb3JlXQpNb2R1bGVzIGxpbmtlZCBpbjogdHBt
X3Rpc19zcGkgdHBtX3Rpc19jb3JlIHRwbSBzaGEyNTZfZ2VuZXJpYyBjZmc4MDIxMSByZmtpbGwg
ODAyMXEgZ2FycCBzdHAgbGxjIHNwaWRldiB2M2QgZ3B1X3NjaGVkIHZjNCBiY20yODM1X2NvZGVj
KEMpIGNlYyByYXNwYmVycnlwaV9od21vbiBkcm1fa21zX2hlbHBlciBkcm0gYmNtMjgzNV9pc3Ao
QykgdjRsMl9tZW0ybWVtIGJjbTI4MzVfdjRsMihDKSBiY20yODM1X21tYWxfdmNoaXEoQykgdmlk
ZW9idWYyX3ZtYWxsb2MgdmlkZW9idWYyX2RtYV9jb250aWcgc25kX2JjbTI4MzUoQykgdmlkZW9i
dWYyX21lbW9wcyBkcm1fcGFuZWxfb3JpZW50YXRpb25fcXVpcmtzIHZpZGVvYnVmMl92NGwyIHZp
ZGVvYnVmMl9jb21tb24gc25kX3NvY19jb3JlIHNuZF9jb21wcmVzcyB2aWRlb2RldiBzbmRfcGNt
X2RtYWVuZ2luZSBzcGlfYmNtMjgzNSBzbmRfcGNtIG1jIHZjX3NtX2NtYShDKSBzbmRfdGltZXIg
c25kIHN5c2NvcHlhcmVhIHJwaXZpZF9tZW0gc3lzZmlsbHJlY3Qgc3lzaW1nYmx0IGZiX3N5c19m
b3BzIGJhY2tsaWdodCB1aW9fcGRydl9nZW5pcnEgdWlvIGlwX3RhYmxlcyB4X3RhYmxlcyBpcHY2
IFtsYXN0IHVubG9hZGVkOiB0cG1dCkNQVTogMCBQSUQ6IDg3NCBDb21tOiBrd29ya2VyL3U4OjEg
VGFpbnRlZDogRyAgICAgICAgV0MgICAgICAgIDUuMTEuMC1yYzItTFMtSE9NRSsgIzEKSGFyZHdh
cmUgbmFtZTogUmFzcGJlcnJ5IFBpIENvbXB1dGUgTW9kdWxlIDQgUmV2IDEuMCAoRFQpCldvcmtx
dWV1ZTogZXZlbnRzX3VuYm91bmQgYXN5bmNfcnVuX2VudHJ5X2ZuCnBzdGF0ZTogODAwMDAwMDUg
KE56Y3YgZGFpZiAtUEFOIC1VQU8gLVRDTyBCVFlQRT0tLSkKcGMgOiB0cG1fdGlzX3N0YXR1cysw
eGJjLzB4YzggW3RwbV90aXNfY29yZV0KbHIgOiB0cG1fdGlzX3N0YXR1cysweGJjLzB4YzggW3Rw
bV90aXNfY29yZV0Kc3AgOiBmZmZmZmZjMDEyN2UzOGYwCngyOTogZmZmZmZmYzAxMjdlMzhmMCB4
Mjg6IGZmZmZmZmMwMTEyMzgwMDAKeDI3OiAwMDAwMDAwMDAwMDAwMDE2IHgyNjogMDAwMDAwMDAw
MDAwMDE3YQp4MjU6IDAwMDAwMDAwMDAwMDAwMTQgeDI0OiBmZmZmZmY4MDQ3ZjYwMDAwCngyMzog
MDAwMDAwMDAwMDAwMDAwMCB4MjI6IDAwMDAwMDAwMDAwMDAwMTYKeDIxOiBmZmZmZmY4MDQ0ZThh
NDgwIHgyMDogMDAwMDAwMDAwMDAwMDAwMAp4MTk6IGZmZmZmZmMwMTEyMzgwMDAgeDE4OiBmZmZm
ZmZjMDExMjM4OTQ4CngxNzogMDAwMDAwMDAwMDAwMDAwMCB4MTY6IDAwMDAwMDAwMDAwMDAwMDAK
eDE1OiBmZmZmZmZjMDExNDFiZTgxIHgxNDogZmZmZmZmZmZmZmZmZmZmZgp4MTM6IGZmZmZmZmMw
MTE0MWJlN2UgeDEyOiBmZmZmZmZmZmZmZmZmZmZmCngxMTogZmZmZmZmODA3ZmI3OTdmMCB4MTA6
IDAwMDAwMDAwMDAwMDE5YjAKeDkgOiBmZmZmZmZjMDEyN2UzOGYwIHg4IDogNzY2ZTY5MjA2NDY1
NmU3Mgp4NyA6IDAwMDAwMDAwMDAwMDAwMDAgeDYgOiBmZmZmZmZjMDExMjM5MDAwCng1IDogZmZm
ZmZmODA3ZmI2MjhiOCB4NCA6IDAwMDAwMDAwMDAwMDAwMDAKeDMgOiAwMDAwMDAwMDAwMDAwMDI3
IHgyIDogMDAwMDAwMDAwMDAwMDAwMAp4MSA6IDY4MThiNmYyMmZkZWY4MDAgeDAgOiAwMDAwMDAw
MDAwMDAwMDAwCkNhbGwgdHJhY2U6CnRwbV90aXNfc3RhdHVzKzB4YmMvMHhjOCBbdHBtX3Rpc19j
b3JlXQp0cG1fdGlzX3NlbmRfZGF0YSsweDU4LzB4MjUwIFt0cG1fdGlzX2NvcmVdCnRwbV90aXNf
c2VuZF9tYWluKzB4NTAvMHgxMjggW3RwbV90aXNfY29yZV0KdHBtX3Rpc19zZW5kKzB4NGMvMHhl
MCBbdHBtX3Rpc19jb3JlXQp0cG1fdHJhbnNtaXQrMHhkMC8weDM1MCBbdHBtXQp0cG1fdHJhbnNt
aXRfY21kKzB4M2MvMHhjMCBbdHBtXQp0cG0yX2dldF90cG1fcHQrMHgxMjQvMHgxZTggW3RwbV0K
dHBtX3Rpc19wcm9iZV9pcnFfc2luZ2xlKzB4MTk4LzB4MzY0IFt0cG1fdGlzX2NvcmVdCnRwbV90
aXNfY29yZV9pbml0KzB4MzA0LzB4NTIwIFt0cG1fdGlzX2NvcmVdCnRwbV90aXNfc3BpX2luaXQr
MHg1Yy8weDc4IFt0cG1fdGlzX3NwaV0KdHBtX3Rpc19zcGlfcHJvYmUrMHg4MC8weDk4IFt0cG1f
dGlzX3NwaV0KdHBtX3Rpc19zcGlfZHJpdmVyX3Byb2JlKzB4NGMvMHg2MCBbdHBtX3Rpc19zcGld
CnNwaV9wcm9iZSsweDg0LzB4ZjAKcmVhbGx5X3Byb2JlKzB4MTE4LzB4NDIwCmRyaXZlcl9wcm9i
ZV9kZXZpY2UrMHg1Yy8weGMwCl9fZHJpdmVyX2F0dGFjaF9hc3luY19oZWxwZXIrMHg2NC8weDY4
CmFzeW5jX3J1bl9lbnRyeV9mbisweDQ4LzB4MTUwCnByb2Nlc3Nfb25lX3dvcmsrMHgxNWMvMHg0
ZDAKd29ya2VyX3RocmVhZCsweDUwLzB4NDkwCmt0aHJlYWQrMHgxMTgvMHgxNTAKcmV0X2Zyb21f
Zm9yaysweDEwLzB4MWMKClRoZSByZWFzb24gZm9yIHRoaXMgaXNzdWUgaXMgdGhhdCBpbiBjYXNl
IG9mIFRQTSAyIGZ1bmN0aW9uCnRwbTJfZ2V0X3RpbWVvdXRzKCkgd2hpY2ggZXhlY3V0ZXMgYSBU
UE0gY29tbWFuZCBpcyBjYWxsZWQgd2l0aG91dCBhCmNsYWltZWQgbG9jYWxpdHkuIFNpbmNlIHdp
dGggdGhpcyBwYXRjaCB0aGUgbG9jYWxpdHkgaXMgdGFrZW4gb25jZSBhdApkcml2ZXIgc3RhcnR1
cCBhbmQgbmV2ZXIgcmVsZWFzZWQgYmVmb3JlIHNodXRkb3duIHRoZSBpc3N1ZSBkb2VzIG5vdCBv
Y2N1cgphbnkgbW9yZS4KCkZpeGVzOiBhM2ZiZmFlODJiNGMgKCJ0cG06IHRha2UgVFBNIGNoaXAg
cG93ZXIgZ2F0aW5nIG91dCBvZiB0cG1fdHJhbnNtaXQoKSIpClNpZ25lZC1vZmYtYnk6IExpbm8g
U2FuZmlsaXBwbyA8TGlub1NhbmZpbGlwcG9AZ214LmRlPgotLS0KIGRyaXZlcnMvY2hhci90cG0v
dHBtLWNoaXAuYyAgICAgfCA0MCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIGRy
aXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmMgfCAzNSArKysrKysrKystLS0tLS0tLS0tLS0t
LS0tLS0tLQogaW5jbHVkZS9saW51eC90cG0uaCAgICAgICAgICAgICB8ICAzIC0tLQogMyBmaWxl
cyBjaGFuZ2VkLCAxMCBpbnNlcnRpb25zKCspLCA2OCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2NoYXIvdHBtL3RwbS1jaGlwLmMgYi9kcml2ZXJzL2NoYXIvdHBtL3RwbS1jaGlw
LmMKaW5kZXggZGRhZWNlYjdlMTA5Li5hMDliNjUyMzI2MWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Y2hhci90cG0vdHBtLWNoaXAuYworKysgYi9kcml2ZXJzL2NoYXIvdHBtL3RwbS1jaGlwLmMKQEAg
LTMyLDM1ICszMiw2IEBAIHN0cnVjdCBjbGFzcyAqdHBtX2NsYXNzOwogc3RydWN0IGNsYXNzICp0
cG1ybV9jbGFzczsKIGRldl90IHRwbV9kZXZ0OwogCi1zdGF0aWMgaW50IHRwbV9yZXF1ZXN0X2xv
Y2FsaXR5KHN0cnVjdCB0cG1fY2hpcCAqY2hpcCkKLXsKLQlpbnQgcmM7Ci0KLQlpZiAoIWNoaXAt
Pm9wcy0+cmVxdWVzdF9sb2NhbGl0eSkKLQkJcmV0dXJuIDA7Ci0KLQlyYyA9IGNoaXAtPm9wcy0+
cmVxdWVzdF9sb2NhbGl0eShjaGlwLCAwKTsKLQlpZiAocmMgPCAwKQotCQlyZXR1cm4gcmM7Ci0K
LQljaGlwLT5sb2NhbGl0eSA9IHJjOwotCXJldHVybiAwOwotfQotCi1zdGF0aWMgdm9pZCB0cG1f
cmVsaW5xdWlzaF9sb2NhbGl0eShzdHJ1Y3QgdHBtX2NoaXAgKmNoaXApCi17Ci0JaW50IHJjOwot
Ci0JaWYgKCFjaGlwLT5vcHMtPnJlbGlucXVpc2hfbG9jYWxpdHkpCi0JCXJldHVybjsKLQotCXJj
ID0gY2hpcC0+b3BzLT5yZWxpbnF1aXNoX2xvY2FsaXR5KGNoaXAsIGNoaXAtPmxvY2FsaXR5KTsK
LQlpZiAocmMpCi0JCWRldl9lcnIoJmNoaXAtPmRldiwgIiVzOiA6IGVycm9yICVkXG4iLCBfX2Z1
bmNfXywgcmMpOwotCi0JY2hpcC0+bG9jYWxpdHkgPSAtMTsKLX0KLQogc3RhdGljIGludCB0cG1f
Y21kX3JlYWR5KHN0cnVjdCB0cG1fY2hpcCAqY2hpcCkKIHsKIAlpZiAoIWNoaXAtPm9wcy0+Y21k
X3JlYWR5KQpAQCAtMTAzLDE3ICs3NCw4IEBAIGludCB0cG1fY2hpcF9zdGFydChzdHJ1Y3QgdHBt
X2NoaXAgKmNoaXApCiAKIAl0cG1fY2xrX2VuYWJsZShjaGlwKTsKIAotCWlmIChjaGlwLT5sb2Nh
bGl0eSA9PSAtMSkgewotCQlyZXQgPSB0cG1fcmVxdWVzdF9sb2NhbGl0eShjaGlwKTsKLQkJaWYg
KHJldCkgewotCQkJdHBtX2Nsa19kaXNhYmxlKGNoaXApOwotCQkJcmV0dXJuIHJldDsKLQkJfQot
CX0KLQogCXJldCA9IHRwbV9jbWRfcmVhZHkoY2hpcCk7CiAJaWYgKHJldCkgewotCQl0cG1fcmVs
aW5xdWlzaF9sb2NhbGl0eShjaGlwKTsKIAkJdHBtX2Nsa19kaXNhYmxlKGNoaXApOwogCQlyZXR1
cm4gcmV0OwogCX0KQEAgLTEzMyw3ICs5NSw2IEBAIEVYUE9SVF9TWU1CT0xfR1BMKHRwbV9jaGlw
X3N0YXJ0KTsKIHZvaWQgdHBtX2NoaXBfc3RvcChzdHJ1Y3QgdHBtX2NoaXAgKmNoaXApCiB7CiAJ
dHBtX2dvX2lkbGUoY2hpcCk7Ci0JdHBtX3JlbGlucXVpc2hfbG9jYWxpdHkoY2hpcCk7CiAJdHBt
X2Nsa19kaXNhYmxlKGNoaXApOwogfQogRVhQT1JUX1NZTUJPTF9HUEwodHBtX2NoaXBfc3RvcCk7
CkBAIC0zOTIsNyArMzUzLDYgQEAgc3RydWN0IHRwbV9jaGlwICp0cG1fY2hpcF9hbGxvYyhzdHJ1
Y3QgZGV2aWNlICpwZGV2LAogCQlnb3RvIG91dDsKIAl9CiAKLQljaGlwLT5sb2NhbGl0eSA9IC0x
OwogCXJldHVybiBjaGlwOwogCiBvdXQ6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2NoYXIvdHBtL3Rw
bV90aXNfY29yZS5jIGIvZHJpdmVycy9jaGFyL3RwbS90cG1fdGlzX2NvcmUuYwppbmRleCBhMTI5
OTJhZTJhM2UuLmY4OTJiMWFlNDZmMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9jaGFyL3RwbS90cG1f
dGlzX2NvcmUuYworKysgYi9kcml2ZXJzL2NoYXIvdHBtL3RwbV90aXNfY29yZS5jCkBAIC02MjYs
OSArNjI2LDYgQEAgc3RhdGljIGludCBwcm9iZV9pdHBtKHN0cnVjdCB0cG1fY2hpcCAqY2hpcCkK
IAlpZiAodmVuZG9yICE9IFRQTV9WSURfSU5URUwpCiAJCXJldHVybiAwOwogCi0JaWYgKHJlcXVl
c3RfbG9jYWxpdHkoY2hpcCwgMCkgIT0gMCkKLQkJcmV0dXJuIC1FQlVTWTsKLQogCXJjID0gdHBt
X3Rpc19zZW5kX2RhdGEoY2hpcCwgY21kX2dldHRpY2tzLCBsZW4pOwogCWlmIChyYyA9PSAwKQog
CQlnb3RvIG91dDsKQEAgLTY0Nyw3ICs2NDQsNiBAQCBzdGF0aWMgaW50IHByb2JlX2l0cG0oc3Ry
dWN0IHRwbV9jaGlwICpjaGlwKQogCiBvdXQ6CiAJdHBtX3Rpc19yZWFkeShjaGlwKTsKLQlyZWxl
YXNlX2xvY2FsaXR5KGNoaXAsIHByaXYtPmxvY2FsaXR5KTsKIAogCXJldHVybiByYzsKIH0KQEAg
LTcwNywyMiArNzAzLDEzIEBAIHN0YXRpYyBpbnQgdHBtX3Rpc19nZW5faW50ZXJydXB0KHN0cnVj
dCB0cG1fY2hpcCAqY2hpcCkKIAljb25zdCBjaGFyICpkZXNjID0gImF0dGVtcHRpbmcgdG8gZ2Vu
ZXJhdGUgYW4gaW50ZXJydXB0IjsKIAl1MzIgY2FwMjsKIAljYXBfdCBjYXA7Ci0JaW50IHJldDsK
IAogCS8qIFRQTSAyLjAgKi8KIAlpZiAoY2hpcC0+ZmxhZ3MgJiBUUE1fQ0hJUF9GTEFHX1RQTTIp
CiAJCXJldHVybiB0cG0yX2dldF90cG1fcHQoY2hpcCwgMHgxMDAsICZjYXAyLCBkZXNjKTsKIAog
CS8qIFRQTSAxLjIgKi8KLQlyZXQgPSByZXF1ZXN0X2xvY2FsaXR5KGNoaXAsIDApOwotCWlmIChy
ZXQgPCAwKQotCQlyZXR1cm4gcmV0OwotCi0JcmV0ID0gdHBtMV9nZXRjYXAoY2hpcCwgVFBNX0NB
UF9QUk9QX1RJU19USU1FT1VULCAmY2FwLCBkZXNjLCAwKTsKLQotCXJlbGVhc2VfbG9jYWxpdHko
Y2hpcCwgMCk7Ci0KLQlyZXR1cm4gcmV0OworCXJldHVybiB0cG0xX2dldGNhcChjaGlwLCBUUE1f
Q0FQX1BST1BfVElTX1RJTUVPVVQsICZjYXAsIGRlc2MsIDApOwogfQogCiAvKiBSZWdpc3RlciB0
aGUgSVJRIGFuZCBpc3N1ZSBhIGNvbW1hbmQgdGhhdCB3aWxsIGNhdXNlIGFuIGludGVycnVwdC4g
SWYgYW4KQEAgLTgzNiw2ICs4MjMsNyBAQCB2b2lkIHRwbV90aXNfcmVtb3ZlKHN0cnVjdCB0cG1f
Y2hpcCAqY2hpcCkKIAogCXRwbV90aXNfd3JpdGUzMihwcml2LCByZWcsIH5UUE1fR0xPQkFMX0lO
VF9FTkFCTEUgJiBpbnRlcnJ1cHQpOwogCisJcmVsZWFzZV9sb2NhbGl0eShjaGlwLCAwKTsKIAl0
cG1fdGlzX2Nsa3J1bl9lbmFibGUoY2hpcCwgZmFsc2UpOwogCiAJaWYgKHByaXYtPmlsYl9iYXNl
X2FkZHIpCkBAIC05NjMsNiArOTUxLDE0IEBAIGludCB0cG1fdGlzX2NvcmVfaW5pdChzdHJ1Y3Qg
ZGV2aWNlICpkZXYsIHN0cnVjdCB0cG1fdGlzX2RhdGEgKnByaXYsIGludCBpcnEsCiAJCWdvdG8g
b3V0X2VycjsKIAl9CiAKKwlyYyA9IHJlcXVlc3RfbG9jYWxpdHkoY2hpcCwgMCk7CisJaWYgKHJj
KQorCQlnb3RvIG91dF9lcnI7CisKKwlyYyA9IHRwbV9jaGlwX3N0YXJ0KGNoaXApOworCWlmIChy
YykKKwkJZ290byBvdXRfZXJyOworCiAJLyogVGFrZSBjb250cm9sIG9mIHRoZSBUUE0ncyBpbnRl
cnJ1cHQgaGFyZHdhcmUgYW5kIHNodXQgaXQgb2ZmICovCiAJcmMgPSB0cG1fdGlzX3JlYWQzMihw
cml2LCBUUE1fSU5UX0VOQUJMRShwcml2LT5sb2NhbGl0eSksICZpbnRtYXNrKTsKIAlpZiAocmMg
PCAwKQpAQCAtOTczLDkgKzk2OSw2IEBAIGludCB0cG1fdGlzX2NvcmVfaW5pdChzdHJ1Y3QgZGV2
aWNlICpkZXYsIHN0cnVjdCB0cG1fdGlzX2RhdGEgKnByaXYsIGludCBpcnEsCiAJaW50bWFzayAm
PSB+VFBNX0dMT0JBTF9JTlRfRU5BQkxFOwogCXRwbV90aXNfd3JpdGUzMihwcml2LCBUUE1fSU5U
X0VOQUJMRShwcml2LT5sb2NhbGl0eSksIGludG1hc2spOwogCi0JcmMgPSB0cG1fY2hpcF9zdGFy
dChjaGlwKTsKLQlpZiAocmMpCi0JCWdvdG8gb3V0X2VycjsKIAlyYyA9IHRwbTJfcHJvYmUoY2hp
cCk7CiAJdHBtX2NoaXBfc3RvcChjaGlwKTsKIAlpZiAocmMpCkBAIC0xMDM2LDE1ICsxMDI5LDcg
QEAgaW50IHRwbV90aXNfY29yZV9pbml0KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IHRwbV90
aXNfZGF0YSAqcHJpdiwgaW50IGlycSwKIAkJICogdG8gbWFrZSBzdXJlIGl0IHdvcmtzLiBNYXkg
YXMgd2VsbCB1c2UgdGhhdCBjb21tYW5kIHRvIHNldCB0aGUKIAkJICogcHJvcGVyIHRpbWVvdXRz
IGZvciB0aGUgZHJpdmVyLgogCQkgKi8KLQotCQlyYyA9IHJlcXVlc3RfbG9jYWxpdHkoY2hpcCwg
MCk7Ci0JCWlmIChyYyA8IDApCi0JCQlnb3RvIG91dF9lcnI7Ci0KIAkJcmMgPSB0cG1fZ2V0X3Rp
bWVvdXRzKGNoaXApOwotCi0JCXJlbGVhc2VfbG9jYWxpdHkoY2hpcCwgMCk7Ci0KIAkJaWYgKHJj
KSB7CiAJCQlkZXZfZXJyKGRldiwgIkNvdWxkIG5vdCBnZXQgVFBNIHRpbWVvdXRzIGFuZCBkdXJh
dGlvbnNcbiIpOwogCQkJcmMgPSAtRU5PREVWOwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC90
cG0uaCBiL2luY2x1ZGUvbGludXgvdHBtLmgKaW5kZXggYWExMWZlMzIzYzU2Li43YTY4ODMyYjE0
YmIgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvbGludXgvdHBtLmgKKysrIGIvaW5jbHVkZS9saW51eC90
cG0uaApAQCAtMTY3LDkgKzE2Nyw2IEBAIHN0cnVjdCB0cG1fY2hpcCB7CiAJdTMyIGxhc3RfY2M7
CiAJdTMyIG5yX2NvbW1hbmRzOwogCXUzMiAqY2NfYXR0cnNfdGJsOwotCi0JLyogYWN0aXZlIGxv
Y2FsaXR5ICovCi0JaW50IGxvY2FsaXR5OwogfTsKIAogI2RlZmluZSBUUE1fSEVBREVSX1NJWkUJ
CTEwCi0tIAoyLjMxLjEKCg==
