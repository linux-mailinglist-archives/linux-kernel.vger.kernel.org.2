Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id A520736A9E7
	for <lists+linux-kernel@lfdr.de>; Mon, 26 Apr 2021 01:48:51 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S231451AbhDYXt3 (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Sun, 25 Apr 2021 19:49:29 -0400
Received: from mout.gmx.net ([212.227.15.15]:48203 "EHLO mout.gmx.net"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S231390AbhDYXt2 (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 25 Apr 2021 19:49:28 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=gmx.net;
        s=badeba3b8450; t=1619394515;
        bh=Xww4Ajq5FtsV2InsBHbQvTZ0c/V2QTCq+DzOOmOMrTU=;
        h=X-UI-Sender-Class:From:To:Cc:Subject:Date:In-Reply-To:References;
        b=QpRhy7kVrTPPDnMO6TynlsUbffsvejK/Q16hrM2K97oOGn4FRR4/6915TKCy0b3EP
         SaUWQhwtsGlaYk52tJxjcYgGwLNpfAXllKwQuF3C+2uXKF+gPOSGOtmTmlehHGfKeL
         tpjt3pR2ixAxlnIgIqN4a7XfutFTqLRd3teiIU9o=
X-UI-Sender-Class: 01bb95c1-4bf8-414a-932a-4f6e2808ef9c
Received: from Venus.fritz.box ([78.42.220.31]) by mail.gmx.net (mrgmx004
 [212.227.17.190]) with ESMTPSA (Nemesis) id 1MCKBc-1lk7tY3TW6-009Psi; Mon, 26
 Apr 2021 01:48:34 +0200
From:   Lino Sanfilippo <LinoSanfilippo@gmx.de>
To:     peterhuewe@gmx.de, jarkko@kernel.org, jgg@ziepe.ca
Cc:     stefanb@linux.vnet.ibm.com, James.Bottomley@hansenpartnership.com,
        keescook@chromium.org, jsnitsel@redhat.com, ml.linux@elloe.vision,
        linux-integrity@vger.kernel.org, linux-kernel@vger.kernel.org,
        LinoSanfilippo@gmx.de
Subject: [PATCH v2 2/4] tpm: Simplify locality handling
Date:   Mon, 26 Apr 2021 01:47:18 +0200
Message-Id: <1619394440-30646-3-git-send-email-LinoSanfilippo@gmx.de>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1619394440-30646-1-git-send-email-LinoSanfilippo@gmx.de>
References: <1619394440-30646-1-git-send-email-LinoSanfilippo@gmx.de>
MIME-Version: 1.0
Content-Transfer-Encoding: base64
X-Provags-ID: V03:K1:MhFeeekzXwlyQvicCmDig9fh5Z7o7xbqM1w2TmkX3EEzwfquFR8
 U03udUqErY5gQ74ZvOgW85KlNRkdyxEao7LvxCCziXeCQ4V5IDzQLuIRC6uPFRy2eeuJgql
 cQFtDd59/tkMf115aSUDf54Jd+7Sarhr593FqGeaUu41/9tX9V6H4VmPIj+sSWXfzohWi58
 U8kPcnA0BJMHCufTkDmbw==
X-Spam-Flag: NO
X-UI-Out-Filterresults: notjunk:1;V03:K0:bAsRxkr/G+E=:PlOk/vdDvn2Bkx5SVw2Z8j
 JRFODMoy0nPxlJWQRd1vH9+2o2XWRgAMAyF5QQSsqUuTjMiWeXMPsaY0XMuUGDuJYX3jB1Ixj
 ZWB14b3WF+QskQR9O8EKUbs9GDcgRh+yVNWqWXvZkxzHPv/xXP2SBg1oEoV0X/iZHpW4RXIr2
 y7teVLFqgDMtZIVTSkJlRUCrBir6Jr3HbpjVlEsVlcC5gcliEGPi43da9EpOZ/rP5ZIKkmC6w
 40bTIJJj8BWYDMKziJWSYg2fXRJktGdVE7FAayBZptT5xkNpfB5K/3OwUx+T/Vkm5/4s6e0r7
 aGl2Bdwrk3Jc3HbuyMJApuUN8jyTeYSStpijuiY+hqb6rRNsoMhKl6ShGTTnEHaVI5OC5CXLb
 YSL7xnxZc6cxWmnXEbV2GrVkONCEoD15DqCOoNnKr2A5jcLBkt3e/JJkXovHOp/tnkrZgkqeB
 rwxZyds206K2AjoJeNXnTAC6NUSNSE5yrJbAVGncR5/7vqtS+7BX+fKfOF40fLb3XqqVfs35V
 JQ6YYfuJ2+c8JOHTh9ygP2UyXQXynOk031VCi7vQdhZyU/ehOff0Ci87I/c/zLY0tJGJXmeZW
 NBgL7Sxx7zg8+BUj3rL3yojXJ3gAiNy9RoZgLqDf5t9aV++zTgmcLg1tZyyTn0Yq6TA+x8DYp
 8TncvU0Mj6JZ8JJqx1EXWyNRL6FxHmDo9fyENPYLQuggx51RUxWylr+s7NO5bEp4MX74pFBbF
 5hF+IgBdufVna7WxcxVSQV7N/c89ME35fVyhFTQHbpGwAmWQL9hFNyRo8OB56SosivsiQQFgN
 mwv/+MIzpD0BkiMjA0i6rirqLWXZ6qC+cUXc7Pp1farOwXrTB5b1L2NqJ0uvemlybthUvnrrT
 SMmYA1Bzw85UuNp9Wv+VzXUdvp+GfOVE4BQY/1yA2v8N3GkEYwzZ3jogXTPfGVBIkYSho66PX
 /pgCke7TaVfNfTGfB1a64jnZ7gUA3TvBfDXr0/8IYAtswHau8HCqyL0gn5LN2HGZCaNDaiYp9
 itlucyLW/qDrErBfDK/NKMbggHz4my/JMwJAowAUow9ybQjWbh9a+z2u4bwyJ4mSm8hAhCKkC
 isnEpvaIgv8u9co4pQGmvhQoUv9vMA7DcpQBU1zHyT6Nn0NGNgmFsQoDxfPECtKkdz6sEYrKS
 C+XwiUs9jCpcws8VvDHSMJoR5CBfxlelBNYd3euXxDOHSlahAByvgU4IWCcDHxYjKmwxAKvSr
 DbrAksy5Qvm+KbC1F
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Q3VycmVudGx5IHRoZSBUUE0gKGRlZmF1bHQpIGxvY2FsaXR5IGlzIGNsYWltZWQgYW5kIHJlbGVh
c2VkIGZvciBlYWNoCmFjY2VzcyB0byB0aGUgVFBNIHJlZ2lzdGVycyB3aGljaCByZXF1aXJlIGEg
Y2xhaW1lZCBsb2NhbGl0eS4gVGhpcyByZXN1bHRzCmluIGxvY2FsaXR5IGNsYWltL3JlbGVhc2Ug
Y29tYm9zIGF0IHZhcmlvdXMgY29kZSBwbGFjZXMuIEZvciBpbnRlcnJ1cHQKaGFuZGxpbmcgd2Ug
YWxzbyBuZWVkIHN1Y2ggYSBjb21ibyBpbiB0aGUgaW50ZXJydXB0IGhhbmRsZXIgKGZvciBjbGVh
cmluZwp0aGUgaW50ZXJydXB0cykgd2hpY2ggbWFrZXMgdGhlIGxvY2FsaXR5IGhhbmRsaW5nIGV2
ZW4gbW9yZSBjb21wbGljYXRlZApzaW5jZSBub3cgd2UgYWxzbyBoYXZlIHRvIHN5bmNocm9uaXpl
IGNvbmN1cnJlbnQgYWNjZXNzZXMgaW4gcHJvY2VzcyBhbmQgaW4KaW50ZXJydXB0IGNvbnRleHQu
CgpTaW5jZSBjdXJyZW50bHkgdGhlIGRyaXZlciB1c2VzIG9ubHkgb25lIGxvY2FsaXR5IGFueXdh
eSwgYXZvaWQgdGhlCmluY3JlYXNpbmcgY29tcGxleGl0eSBieSBjbGFpbWluZyBpdCBvbmNlIGF0
IGRyaXZlciBzdGFydHVwIGFuZCBvbmx5CnJlbGVhc2luZyBpdCBhdCBkcml2ZXIgc2h1dGRvd24u
CgpEdWUgdG8gdGhlIHNpbXBsaWZpY2F0aW9ucyB0aGUgZnVuY3Rpb25zIHRwbV9yZXF1ZXN0X2xv
Y2FsaXR5KCkgYW5kCnRwbV9yZWxpbnF1aXNoX2xvY2FsaXR5KCkgYXJlIG5vdCBuZWVkZWQgYW55
IG1vcmUgYW4gY2FuIGJlIHJlbW92ZWQuCgpBcyBhIHNpZGUtZWZmZWN0IHRoZXNlIG1vZGlmaWNh
dGlvbnMgZml4IGEgYnVnIHdoaWNoIHJlc3VsdHMgaW4gdGhlCmZvbGxvd2luZyB3YXJuaW5nIHdo
ZW4gdXNpbmcgVFBNIDI6CgpUUE0gcmV0dXJuZWQgaW52YWxpZCBzdGF0dXMKV0FSTklORzogQ1BV
OiAwIFBJRDogODc0IGF0IGRyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmM6MjQ5IHRwbV90
aXNfc3RhdHVzKzB4YmMvMHhjOCBbdHBtX3Rpc19jb3JlXQpNb2R1bGVzIGxpbmtlZCBpbjogdHBt
X3Rpc19zcGkgdHBtX3Rpc19jb3JlIHRwbSBzaGEyNTZfZ2VuZXJpYyBjZmc4MDIxMSByZmtpbGwg
ODAyMXEgZ2FycCBzdHAgbGxjIHNwaWRldiB2M2QgZ3B1X3NjaGVkIHZjNCBiY20yODM1X2NvZGVj
KEMpIGNlYyByYXNwYmVycnlwaV9od21vbiBkcm1fa21zX2hlbHBlciBkcm0gYmNtMjgzNV9pc3Ao
QykgdjRsMl9tZW0ybWVtIGJjbTI4MzVfdjRsMihDKSBiY20yODM1X21tYWxfdmNoaXEoQykgdmlk
ZW9idWYyX3ZtYWxsb2MgdmlkZW9idWYyX2RtYV9jb250aWcgc25kX2JjbTI4MzUoQykgdmlkZW9i
dWYyX21lbW9wcyBkcm1fcGFuZWxfb3JpZW50YXRpb25fcXVpcmtzIHZpZGVvYnVmMl92NGwyIHZp
ZGVvYnVmMl9jb21tb24gc25kX3NvY19jb3JlIHNuZF9jb21wcmVzcyB2aWRlb2RldiBzbmRfcGNt
X2RtYWVuZ2luZSBzcGlfYmNtMjgzNSBzbmRfcGNtIG1jIHZjX3NtX2NtYShDKSBzbmRfdGltZXIg
c25kIHN5c2NvcHlhcmVhIHJwaXZpZF9tZW0gc3lzZmlsbHJlY3Qgc3lzaW1nYmx0IGZiX3N5c19m
b3BzIGJhY2tsaWdodCB1aW9fcGRydl9nZW5pcnEgdWlvIGlwX3RhYmxlcyB4X3RhYmxlcyBpcHY2
IFtsYXN0IHVubG9hZGVkOiB0cG1dCkNQVTogMCBQSUQ6IDg3NCBDb21tOiBrd29ya2VyL3U4OjEg
VGFpbnRlZDogRyAgICAgICAgV0MgICAgICAgIDUuMTEuMC1yYzItTFMtSE9NRSsgIzEKSGFyZHdh
cmUgbmFtZTogUmFzcGJlcnJ5IFBpIENvbXB1dGUgTW9kdWxlIDQgUmV2IDEuMCAoRFQpCldvcmtx
dWV1ZTogZXZlbnRzX3VuYm91bmQgYXN5bmNfcnVuX2VudHJ5X2ZuCnBzdGF0ZTogODAwMDAwMDUg
KE56Y3YgZGFpZiAtUEFOIC1VQU8gLVRDTyBCVFlQRT0tLSkKcGMgOiB0cG1fdGlzX3N0YXR1cysw
eGJjLzB4YzggW3RwbV90aXNfY29yZV0KbHIgOiB0cG1fdGlzX3N0YXR1cysweGJjLzB4YzggW3Rw
bV90aXNfY29yZV0Kc3AgOiBmZmZmZmZjMDEyN2UzOGYwCngyOTogZmZmZmZmYzAxMjdlMzhmMCB4
Mjg6IGZmZmZmZmMwMTEyMzgwMDAKeDI3OiAwMDAwMDAwMDAwMDAwMDE2IHgyNjogMDAwMDAwMDAw
MDAwMDE3YQp4MjU6IDAwMDAwMDAwMDAwMDAwMTQgeDI0OiBmZmZmZmY4MDQ3ZjYwMDAwCngyMzog
MDAwMDAwMDAwMDAwMDAwMCB4MjI6IDAwMDAwMDAwMDAwMDAwMTYKeDIxOiBmZmZmZmY4MDQ0ZThh
NDgwIHgyMDogMDAwMDAwMDAwMDAwMDAwMAp4MTk6IGZmZmZmZmMwMTEyMzgwMDAgeDE4OiBmZmZm
ZmZjMDExMjM4OTQ4CngxNzogMDAwMDAwMDAwMDAwMDAwMCB4MTY6IDAwMDAwMDAwMDAwMDAwMDAK
eDE1OiBmZmZmZmZjMDExNDFiZTgxIHgxNDogZmZmZmZmZmZmZmZmZmZmZgp4MTM6IGZmZmZmZmMw
MTE0MWJlN2UgeDEyOiBmZmZmZmZmZmZmZmZmZmZmCngxMTogZmZmZmZmODA3ZmI3OTdmMCB4MTA6
IDAwMDAwMDAwMDAwMDE5YjAKeDkgOiBmZmZmZmZjMDEyN2UzOGYwIHg4IDogNzY2ZTY5MjA2NDY1
NmU3Mgp4NyA6IDAwMDAwMDAwMDAwMDAwMDAgeDYgOiBmZmZmZmZjMDExMjM5MDAwCng1IDogZmZm
ZmZmODA3ZmI2MjhiOCB4NCA6IDAwMDAwMDAwMDAwMDAwMDAKeDMgOiAwMDAwMDAwMDAwMDAwMDI3
IHgyIDogMDAwMDAwMDAwMDAwMDAwMAp4MSA6IDY4MThiNmYyMmZkZWY4MDAgeDAgOiAwMDAwMDAw
MDAwMDAwMDAwCkNhbGwgdHJhY2U6CnRwbV90aXNfc3RhdHVzKzB4YmMvMHhjOCBbdHBtX3Rpc19j
b3JlXQp0cG1fdGlzX3NlbmRfZGF0YSsweDU4LzB4MjUwIFt0cG1fdGlzX2NvcmVdCnRwbV90aXNf
c2VuZF9tYWluKzB4NTAvMHgxMjggW3RwbV90aXNfY29yZV0KdHBtX3Rpc19zZW5kKzB4NGMvMHhl
MCBbdHBtX3Rpc19jb3JlXQp0cG1fdHJhbnNtaXQrMHhkMC8weDM1MCBbdHBtXQp0cG1fdHJhbnNt
aXRfY21kKzB4M2MvMHhjMCBbdHBtXQp0cG0yX2dldF90cG1fcHQrMHgxMjQvMHgxZTggW3RwbV0K
dHBtX3Rpc19wcm9iZV9pcnFfc2luZ2xlKzB4MTk4LzB4MzY0IFt0cG1fdGlzX2NvcmVdCnRwbV90
aXNfY29yZV9pbml0KzB4MzA0LzB4NTIwIFt0cG1fdGlzX2NvcmVdCnRwbV90aXNfc3BpX2luaXQr
MHg1Yy8weDc4IFt0cG1fdGlzX3NwaV0KdHBtX3Rpc19zcGlfcHJvYmUrMHg4MC8weDk4IFt0cG1f
dGlzX3NwaV0KdHBtX3Rpc19zcGlfZHJpdmVyX3Byb2JlKzB4NGMvMHg2MCBbdHBtX3Rpc19zcGld
CnNwaV9wcm9iZSsweDg0LzB4ZjAKcmVhbGx5X3Byb2JlKzB4MTE4LzB4NDIwCmRyaXZlcl9wcm9i
ZV9kZXZpY2UrMHg1Yy8weGMwCl9fZHJpdmVyX2F0dGFjaF9hc3luY19oZWxwZXIrMHg2NC8weDY4
CmFzeW5jX3J1bl9lbnRyeV9mbisweDQ4LzB4MTUwCnByb2Nlc3Nfb25lX3dvcmsrMHgxNWMvMHg0
ZDAKd29ya2VyX3RocmVhZCsweDUwLzB4NDkwCmt0aHJlYWQrMHgxMTgvMHgxNTAKcmV0X2Zyb21f
Zm9yaysweDEwLzB4MWMKClRoZSByZWFzb24gZm9yIHRoaXMgaXNzdWUgaXMgdGhhdCBpbiBjYXNl
IG9mIFRQTSAyIGZ1bmN0aW9uCnRwbTJfZ2V0X3RpbWVvdXRzKCkgd2hpY2ggZXhlY3V0ZXMgYSBU
UE0gY29tbWFuZCBpcyBjYWxsZWQgd2l0aG91dCBhCmNsYWltZWQgbG9jYWxpdHkuIFNpbmNlIHdp
dGggdGhpcyBwYXRjaCB0aGUgbG9jYWxpdHkgaXMgdGFrZW4gb25jZSBhdApkcml2ZXIgc3RhcnR1
cCBhbmQgbmV2ZXIgcmVsZWFzZWQgYmVmb3JlIHNodXRkb3duIHRoZSBpc3N1ZSBkb2VzIG5vdCBv
Y2N1cgphbnkgbW9yZS4KCkZpeGVzOiBhM2ZiZmFlODJiNGMgKCJ0cG06IHRha2UgVFBNIGNoaXAg
cG93ZXIgZ2F0aW5nIG91dCBvZiB0cG1fdHJhbnNtaXQoKSIpClNpZ25lZC1vZmYtYnk6IExpbm8g
U2FuZmlsaXBwbyA8TGlub1NhbmZpbGlwcG9AZ214LmRlPgotLS0KIGRyaXZlcnMvY2hhci90cG0v
dHBtLWNoaXAuYyAgICAgfCA0MCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tCiBkcml2ZXJzL2NoYXIvdHBtL3RwbV90aXNfY29yZS5jIHwgMzUgKysrKysrKysrKy0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0KIGluY2x1ZGUvbGludXgvdHBtLmggICAgICAgICAgICAgfCAg
MyAtLS0KIDMgZmlsZXMgY2hhbmdlZCwgMTAgaW5zZXJ0aW9ucygrKSwgNjggZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9jaGFyL3RwbS90cG0tY2hpcC5jIGIvZHJpdmVycy9jaGFy
L3RwbS90cG0tY2hpcC5jCmluZGV4IGRkYWVjZWIuLmEwOWI2NTIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvY2hhci90cG0vdHBtLWNoaXAuYworKysgYi9kcml2ZXJzL2NoYXIvdHBtL3RwbS1jaGlwLmMK
QEAgLTMyLDM1ICszMiw2IEBAIHN0cnVjdCBjbGFzcyAqdHBtX2NsYXNzOwogc3RydWN0IGNsYXNz
ICp0cG1ybV9jbGFzczsKIGRldl90IHRwbV9kZXZ0OwogCi1zdGF0aWMgaW50IHRwbV9yZXF1ZXN0
X2xvY2FsaXR5KHN0cnVjdCB0cG1fY2hpcCAqY2hpcCkKLXsKLQlpbnQgcmM7Ci0KLQlpZiAoIWNo
aXAtPm9wcy0+cmVxdWVzdF9sb2NhbGl0eSkKLQkJcmV0dXJuIDA7Ci0KLQlyYyA9IGNoaXAtPm9w
cy0+cmVxdWVzdF9sb2NhbGl0eShjaGlwLCAwKTsKLQlpZiAocmMgPCAwKQotCQlyZXR1cm4gcmM7
Ci0KLQljaGlwLT5sb2NhbGl0eSA9IHJjOwotCXJldHVybiAwOwotfQotCi1zdGF0aWMgdm9pZCB0
cG1fcmVsaW5xdWlzaF9sb2NhbGl0eShzdHJ1Y3QgdHBtX2NoaXAgKmNoaXApCi17Ci0JaW50IHJj
OwotCi0JaWYgKCFjaGlwLT5vcHMtPnJlbGlucXVpc2hfbG9jYWxpdHkpCi0JCXJldHVybjsKLQot
CXJjID0gY2hpcC0+b3BzLT5yZWxpbnF1aXNoX2xvY2FsaXR5KGNoaXAsIGNoaXAtPmxvY2FsaXR5
KTsKLQlpZiAocmMpCi0JCWRldl9lcnIoJmNoaXAtPmRldiwgIiVzOiA6IGVycm9yICVkXG4iLCBf
X2Z1bmNfXywgcmMpOwotCi0JY2hpcC0+bG9jYWxpdHkgPSAtMTsKLX0KLQogc3RhdGljIGludCB0
cG1fY21kX3JlYWR5KHN0cnVjdCB0cG1fY2hpcCAqY2hpcCkKIHsKIAlpZiAoIWNoaXAtPm9wcy0+
Y21kX3JlYWR5KQpAQCAtMTAzLDE3ICs3NCw4IEBAIGludCB0cG1fY2hpcF9zdGFydChzdHJ1Y3Qg
dHBtX2NoaXAgKmNoaXApCiAKIAl0cG1fY2xrX2VuYWJsZShjaGlwKTsKIAotCWlmIChjaGlwLT5s
b2NhbGl0eSA9PSAtMSkgewotCQlyZXQgPSB0cG1fcmVxdWVzdF9sb2NhbGl0eShjaGlwKTsKLQkJ
aWYgKHJldCkgewotCQkJdHBtX2Nsa19kaXNhYmxlKGNoaXApOwotCQkJcmV0dXJuIHJldDsKLQkJ
fQotCX0KLQogCXJldCA9IHRwbV9jbWRfcmVhZHkoY2hpcCk7CiAJaWYgKHJldCkgewotCQl0cG1f
cmVsaW5xdWlzaF9sb2NhbGl0eShjaGlwKTsKIAkJdHBtX2Nsa19kaXNhYmxlKGNoaXApOwogCQly
ZXR1cm4gcmV0OwogCX0KQEAgLTEzMyw3ICs5NSw2IEBAIEVYUE9SVF9TWU1CT0xfR1BMKHRwbV9j
aGlwX3N0YXJ0KTsKIHZvaWQgdHBtX2NoaXBfc3RvcChzdHJ1Y3QgdHBtX2NoaXAgKmNoaXApCiB7
CiAJdHBtX2dvX2lkbGUoY2hpcCk7Ci0JdHBtX3JlbGlucXVpc2hfbG9jYWxpdHkoY2hpcCk7CiAJ
dHBtX2Nsa19kaXNhYmxlKGNoaXApOwogfQogRVhQT1JUX1NZTUJPTF9HUEwodHBtX2NoaXBfc3Rv
cCk7CkBAIC0zOTIsNyArMzUzLDYgQEAgc3RydWN0IHRwbV9jaGlwICp0cG1fY2hpcF9hbGxvYyhz
dHJ1Y3QgZGV2aWNlICpwZGV2LAogCQlnb3RvIG91dDsKIAl9CiAKLQljaGlwLT5sb2NhbGl0eSA9
IC0xOwogCXJldHVybiBjaGlwOwogCiBvdXQ6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2NoYXIvdHBt
L3RwbV90aXNfY29yZS5jIGIvZHJpdmVycy9jaGFyL3RwbS90cG1fdGlzX2NvcmUuYwppbmRleCAw
OTU5NTU5Li5hOTVkYWY4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2NoYXIvdHBtL3RwbV90aXNfY29y
ZS5jCisrKyBiL2RyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmMKQEAgLTY3MCw5ICs2NzAs
NiBAQCBzdGF0aWMgaW50IHByb2JlX2l0cG0oc3RydWN0IHRwbV9jaGlwICpjaGlwKQogCWlmICh2
ZW5kb3IgIT0gVFBNX1ZJRF9JTlRFTCkKIAkJcmV0dXJuIDA7CiAKLQlpZiAocmVxdWVzdF9sb2Nh
bGl0eShjaGlwLCAwKSAhPSAwKQotCQlyZXR1cm4gLUVCVVNZOwotCiAJcmMgPSB0cG1fdGlzX3Nl
bmRfZGF0YShjaGlwLCBjbWRfZ2V0dGlja3MsIGxlbik7CiAJaWYgKHJjID09IDApCiAJCWdvdG8g
b3V0OwpAQCAtNjkxLDcgKzY4OCw2IEBAIHN0YXRpYyBpbnQgcHJvYmVfaXRwbShzdHJ1Y3QgdHBt
X2NoaXAgKmNoaXApCiAKIG91dDoKIAl0cG1fdGlzX3JlYWR5KGNoaXApOwotCXJlbGVhc2VfbG9j
YWxpdHkoY2hpcCwgcHJpdi0+bG9jYWxpdHkpOwogCiAJcmV0dXJuIHJjOwogfQpAQCAtNzUxLDIy
ICs3NDcsMTMgQEAgc3RhdGljIGludCB0cG1fdGlzX2dlbl9pbnRlcnJ1cHQoc3RydWN0IHRwbV9j
aGlwICpjaGlwKQogCWNvbnN0IGNoYXIgKmRlc2MgPSAiYXR0ZW1wdGluZyB0byBnZW5lcmF0ZSBh
biBpbnRlcnJ1cHQiOwogCXUzMiBjYXAyOwogCWNhcF90IGNhcDsKLQlpbnQgcmV0OwogCiAJLyog
VFBNIDIuMCAqLwogCWlmIChjaGlwLT5mbGFncyAmIFRQTV9DSElQX0ZMQUdfVFBNMikKIAkJcmV0
dXJuIHRwbTJfZ2V0X3RwbV9wdChjaGlwLCAweDEwMCwgJmNhcDIsIGRlc2MpOwogCiAJLyogVFBN
IDEuMiAqLwotCXJldCA9IHJlcXVlc3RfbG9jYWxpdHkoY2hpcCwgMCk7Ci0JaWYgKHJldCA8IDAp
Ci0JCXJldHVybiByZXQ7Ci0KLQlyZXQgPSB0cG0xX2dldGNhcChjaGlwLCBUUE1fQ0FQX1BST1Bf
VElTX1RJTUVPVVQsICZjYXAsIGRlc2MsIDApOwotCi0JcmVsZWFzZV9sb2NhbGl0eShjaGlwLCAw
KTsKLQotCXJldHVybiByZXQ7CisJcmV0dXJuIHRwbTFfZ2V0Y2FwKGNoaXAsIFRQTV9DQVBfUFJP
UF9USVNfVElNRU9VVCwgJmNhcCwgZGVzYywgMCk7CiB9CiAKIC8qIFJlZ2lzdGVyIHRoZSBJUlEg
YW5kIGlzc3VlIGEgY29tbWFuZCB0aGF0IHdpbGwgY2F1c2UgYW4gaW50ZXJydXB0LiBJZiBhbgpA
QCAtODgwLDYgKzg2Nyw3IEBAIHZvaWQgdHBtX3Rpc19yZW1vdmUoc3RydWN0IHRwbV9jaGlwICpj
aGlwKQogCiAJdHBtX3Rpc193cml0ZTMyKHByaXYsIHJlZywgflRQTV9HTE9CQUxfSU5UX0VOQUJM
RSAmIGludGVycnVwdCk7CiAKKwlyZWxlYXNlX2xvY2FsaXR5KGNoaXAsIDApOwogCXRwbV90aXNf
Y2xrcnVuX2VuYWJsZShjaGlwLCBmYWxzZSk7CiAKIAlpZiAocHJpdi0+aWxiX2Jhc2VfYWRkcikK
QEAgLTEwMDcsNiArOTk1LDE0IEBAIGludCB0cG1fdGlzX2NvcmVfaW5pdChzdHJ1Y3QgZGV2aWNl
ICpkZXYsIHN0cnVjdCB0cG1fdGlzX2RhdGEgKnByaXYsIGludCBpcnEsCiAJCWdvdG8gb3V0X2Vy
cjsKIAl9CiAKKwlyYyA9IHJlcXVlc3RfbG9jYWxpdHkoY2hpcCwgMCk7CisJaWYgKHJjKQorCQln
b3RvIG91dF9lcnI7CisKKwlyYyA9IHRwbV9jaGlwX3N0YXJ0KGNoaXApOworCWlmIChyYykKKwkJ
Z290byBvdXRfZXJyOworCiAJLyogVGFrZSBjb250cm9sIG9mIHRoZSBUUE0ncyBpbnRlcnJ1cHQg
aGFyZHdhcmUgYW5kIHNodXQgaXQgb2ZmICovCiAJcmMgPSB0cG1fdGlzX3JlYWQzMihwcml2LCBU
UE1fSU5UX0VOQUJMRShwcml2LT5sb2NhbGl0eSksICZpbnRtYXNrKTsKIAlpZiAocmMgPCAwKQpA
QCAtMTAxNyw5ICsxMDEzLDYgQEAgaW50IHRwbV90aXNfY29yZV9pbml0KHN0cnVjdCBkZXZpY2Ug
KmRldiwgc3RydWN0IHRwbV90aXNfZGF0YSAqcHJpdiwgaW50IGlycSwKIAlpbnRtYXNrICY9IH5U
UE1fR0xPQkFMX0lOVF9FTkFCTEU7CiAJdHBtX3Rpc193cml0ZTMyKHByaXYsIFRQTV9JTlRfRU5B
QkxFKHByaXYtPmxvY2FsaXR5KSwgaW50bWFzayk7CiAKLQlyYyA9IHRwbV9jaGlwX3N0YXJ0KGNo
aXApOwotCWlmIChyYykKLQkJZ290byBvdXRfZXJyOwogCXJjID0gdHBtMl9wcm9iZShjaGlwKTsK
IAl0cG1fY2hpcF9zdG9wKGNoaXApOwogCWlmIChyYykKQEAgLTEwODAsMTUgKzEwNzMsNyBAQCBp
bnQgdHBtX3Rpc19jb3JlX2luaXQoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgdHBtX3Rpc19k
YXRhICpwcml2LCBpbnQgaXJxLAogCQkgKiB0byBtYWtlIHN1cmUgaXQgd29ya3MuIE1heSBhcyB3
ZWxsIHVzZSB0aGF0IGNvbW1hbmQgdG8gc2V0IHRoZQogCQkgKiBwcm9wZXIgdGltZW91dHMgZm9y
IHRoZSBkcml2ZXIuCiAJCSAqLwotCi0JCXJjID0gcmVxdWVzdF9sb2NhbGl0eShjaGlwLCAwKTsK
LQkJaWYgKHJjIDwgMCkKLQkJCWdvdG8gb3V0X2VycjsKLQogCQlyYyA9IHRwbV9nZXRfdGltZW91
dHMoY2hpcCk7Ci0KLQkJcmVsZWFzZV9sb2NhbGl0eShjaGlwLCAwKTsKLQogCQlpZiAocmMpIHsK
IAkJCWRldl9lcnIoZGV2LCAiQ291bGQgbm90IGdldCBUUE0gdGltZW91dHMgYW5kIGR1cmF0aW9u
c1xuIik7CiAJCQlyYyA9IC1FTk9ERVY7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L3RwbS5o
IGIvaW5jbHVkZS9saW51eC90cG0uaAppbmRleCA4ZjRmZjM5Li41NWRlYmU2IDEwMDY0NAotLS0g
YS9pbmNsdWRlL2xpbnV4L3RwbS5oCisrKyBiL2luY2x1ZGUvbGludXgvdHBtLmgKQEAgLTE2MCw5
ICsxNjAsNiBAQCBzdHJ1Y3QgdHBtX2NoaXAgewogCXUzMiBsYXN0X2NjOwogCXUzMiBucl9jb21t
YW5kczsKIAl1MzIgKmNjX2F0dHJzX3RibDsKLQotCS8qIGFjdGl2ZSBsb2NhbGl0eSAqLwotCWlu
dCBsb2NhbGl0eTsKIH07CiAKICNkZWZpbmUgVFBNX0hFQURFUl9TSVpFCQkxMAotLSAKMi43LjQK
Cg==
