Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 9BEC33DED26
	for <lists+linux-kernel@lfdr.de>; Tue,  3 Aug 2021 13:48:06 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S235753AbhHCLsK (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Tue, 3 Aug 2021 07:48:10 -0400
Received: from smtp-out1.suse.de ([195.135.220.28]:50676 "EHLO
        smtp-out1.suse.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S236495AbhHCLrj (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Tue, 3 Aug 2021 07:47:39 -0400
Received: from relay2.suse.de (relay2.suse.de [149.44.160.134])
        by smtp-out1.suse.de (Postfix) with ESMTP id 5169822017;
        Tue,  3 Aug 2021 11:47:27 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.de; s=susede2_rsa;
        t=1627991247; h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
         mime-version:mime-version:content-type:content-type:
         in-reply-to:in-reply-to:references:references;
        bh=8O0P7Szt+v58AGp348X81vVsu2pklhC2e1J14fYQW8I=;
        b=lvBgKkgPug5wPtZAhOkjeMXe1jy8ef+wne+nqhjLHbxIQqmCSnTaIofSLbJNn8vBGa7c5M
        qihK51ImKNhsSJYUy9/O/IY5W3NqFgky49eE9i6YpNa4ArxBOrFSuAjqUgD4r3A51KTKuT
        5svuh0xk7hiZRbQ1BQjck6BgLgAv1Bo=
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/relaxed; d=suse.de;
        s=susede2_ed25519; t=1627991247;
        h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
         mime-version:mime-version:content-type:content-type:
         in-reply-to:in-reply-to:references:references;
        bh=8O0P7Szt+v58AGp348X81vVsu2pklhC2e1J14fYQW8I=;
        b=9wTPy7x/et9gZPhd/v55PTclneStv8vMbujwi2OLXqXwXODSld1wNymsKyDX30/nQN5aBp
        8hs4tAtB8XcP6zAw==
Received: from alsa1.suse.de (alsa1.suse.de [10.160.4.42])
        by relay2.suse.de (Postfix) with ESMTP id 01B70A3BDB;
        Tue,  3 Aug 2021 11:47:26 +0000 (UTC)
Date:   Tue, 03 Aug 2021 13:47:26 +0200
Message-ID: <s5h35rqwy0h.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     Alexander Monakov <amonakov@ispras.ru>
Cc:     linux-kernel@vger.kernel.org, Jaroslav Kysela <perex@perex.cz>,
        Takashi Iwai <tiwai@suse.com>,
        Hui Wang <hui.wang@canonical.com>,
        Kailang Yang <kailang@realtek.com>,
        Jeremy Szu <jeremy.szu@canonical.com>,
        Jian-Hong Pan <jhp@endlessos.org>,
        Chris Chiu <chris.chiu@canonical.com>,
        PeiSen Hou <pshou@realtek.com>, alsa-devel@alsa-project.org
Subject: Re: [PATCH] ALSA: hda/realtek: add mic quirk for Acer SF314-42
In-Reply-To: <alpine.LNX.2.20.13.2107282230090.20403@monopod.intra.ispras.ru>
References: <20210721170141.24807-1-amonakov@ispras.ru>
        <s5h7dhabcck.wl-tiwai@suse.de>
        <alpine.LNX.2.20.13.2107282230090.20403@monopod.intra.ispras.ru>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Wed, 28 Jul 2021 22:03:45 +0200,
Alexander Monakov wrote:
> 
> On Wed, 28 Jul 2021, Takashi Iwai wrote:
> 
> > > 1) at high enough gain, recording the microphone is picking up what is
> > > being played via the headphones; maybe it's supposed to be like that,
> > > but it surprised me;
> > 
> > Hrm, that doesn't sound right.  Some internal loopback in the codec?
> > Dunno.  It doesn't pick up the sound physically, right?
> 
> How can I tell? If I don't have anything plugged into the jack, playback
> uses the built-in speakers. In that case there's no feedback. And if I
> plug in a headset or common headphones, then built-in speakers are automatically
> muted, and recording the mic can pick up the output signal.
> 
> Is there a way to forcefully direct output to the jack instead of built-in
> speakers even when there isn't anything plugged in?
> 
> I am sure it is not picking the sound over the air, but I'm considering it's
> picking it up electrically near the jack somehow.
> 
> > > 2) there is a very noticeable "pop" when plugging the headset in/out,
> > > accompanied by
> > > 
> > > pcieport 0000:00:08.1: PME: Spurious native interrupt!
> > > pcieport 0000:00:08.1: PME: Spurious native interrupt!
> > > 
> > > in dmesg. I'd appreciate info and any help about this issue.
> > 
> > The pop noise is often a thing with the codec and there are a bunch of
> > different workarounds found in the driver.  But the spurious interrupt
> > is more worrisome.  Is the PCI slot corresponding to the HD-audio
> > controller?
> 
> No, it's actually the PCI bridge under which the HDA core resides:
> 
> 00:08.1 PCI bridge: Advanced Micro Devices, Inc. [AMD] Renoir Internal PCIe GPP Bridge to Bus
> 00:08.1/03:00.6 Audio device: Advanced Micro Devices, Inc. [AMD] Family 17h (Models 10h-1fh) HD Audio Controller
> 
> Note that I have autosuspend enabled for PCI devices. If I disable PCI
> autosuspend for the 03:00.6 HDA device, there's no "pop" and no spurious
> interrupt. My understanding that the chip generates a power management event
> when it senses a jack plug/unplug event while suspended. Apparently something
> about the PME interrupt is not fully in order?
> 
> > As of now, I'm inclined to take your patch as is, at least as a
> > first-aid workaround.  Let's see whether we get a better development
> > soonish.
> 
> *nod*, I will appreciate it!

FYI, I merged the fix to for-linus branch, which will be likely
included in Linus tree in this week.

For the rest issue, at least about the bogus messages from PCI bridge,
better to report to the PCI subsystem.  It's possibly some missing PCI
quirk for the specific chip.


thanks,

Takashi
