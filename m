Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 0A6663431B8
	for <lists+linux-kernel@lfdr.de>; Sun, 21 Mar 2021 09:36:01 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S229912AbhCUIQt (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Sun, 21 Mar 2021 04:16:49 -0400
Received: from mx2.suse.de ([195.135.220.15]:40840 "EHLO mx2.suse.de"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S229821AbhCUIQQ (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 21 Mar 2021 04:16:16 -0400
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
        by mx2.suse.de (Postfix) with ESMTP id D9177AD38;
        Sun, 21 Mar 2021 08:16:14 +0000 (UTC)
Date:   Sun, 21 Mar 2021 09:16:14 +0100
Message-ID: <s5htup4exbl.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     Tong Zhang <ztong0001@gmail.com>
Cc:     Jaroslav Kysela <perex@perex.cz>, Takashi Iwai <tiwai@suse.com>,
        Romain Perier <romain.perier@gmail.com>,
        Allen Pais <allen.lkml@gmail.com>,
        Leon Romanovsky <leon@kernel.org>,
        Jasmin Fazlic <superfassl@gmail.com>,
        Mark Brown <broonie@kernel.org>, Joe Perches <joe@perches.com>,
        Tom Rix <trix@redhat.com>,
        Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>,
        "Gustavo A. R. Silva" <gustavoars@kernel.org>,
        alsa-devel@alsa-project.org, linux-kernel@vger.kernel.org
Subject: Re: [PATCH v2 0/3] ALSA: hdsp and hdspm, don't disable device if not enabled
In-Reply-To: <20210320222337.243368-1-ztong0001@gmail.com>
References: <20210320222337.243368-1-ztong0001@gmail.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Sat, 20 Mar 2021 23:23:33 +0100,
Tong Zhang wrote:
> 
> This series fixes issues in hdsp and hdspm. The drivers in question want
> to disable a device that is not enabled on error path.
> 
> v2: add fix to rme9652
> 
> Tong Zhang (3):
>   ALSA: hdsp: don't disable if not enabled
>   ALSA: hdspm: don't disable if not enabled
>   ALSA: rme9652: don't disable if not enabled

Thanks for the patches.

IMO, a safer way for this is to add pci_is_enabled() check in *_free()
functions around the call of pci_disable_device().  The point is that
*_free() is the sole destructor function that manages all stuff, hence
it's better to do all there.  And, of course, it'll be less changes.

Care to resend v3 patches with that?


thanks,

Takashi
