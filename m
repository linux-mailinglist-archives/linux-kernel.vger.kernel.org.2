Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 5C68B36A9EB
	for <lists+linux-kernel@lfdr.de>; Mon, 26 Apr 2021 01:49:57 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S231532AbhDYXtj (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Sun, 25 Apr 2021 19:49:39 -0400
Received: from mout.gmx.net ([212.227.15.19]:40533 "EHLO mout.gmx.net"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S231410AbhDYXt2 (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 25 Apr 2021 19:49:28 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=gmx.net;
        s=badeba3b8450; t=1619394515;
        bh=nNu/0Ul8MsEjiiVaxfqHd6w7rqBaq3/E5gUBJry9PPs=;
        h=X-UI-Sender-Class:From:To:Cc:Subject:Date:In-Reply-To:References;
        b=LfrCaWd3OwQi8wCrnuJjEl6x2ta/gf40IjH2xFir4FdZCQE05QEqPJsE6w41gYyHk
         t2qsQ1jKatU4WUelwMb3Pznpn+NYapFLkush5hRysLoNflcsMgOBA9IQ14klpR5R7w
         ePNOtaEOcTXV52To9CGwnnTtjPAfWWR8oWctqNL8=
X-UI-Sender-Class: 01bb95c1-4bf8-414a-932a-4f6e2808ef9c
Received: from Venus.fritz.box ([78.42.220.31]) by mail.gmx.net (mrgmx004
 [212.227.17.190]) with ESMTPSA (Nemesis) id 1MLR1V-1lscBk2UvD-00IWYH; Mon, 26
 Apr 2021 01:48:35 +0200
From:   Lino Sanfilippo <LinoSanfilippo@gmx.de>
To:     peterhuewe@gmx.de, jarkko@kernel.org, jgg@ziepe.ca
Cc:     stefanb@linux.vnet.ibm.com, James.Bottomley@hansenpartnership.com,
        keescook@chromium.org, jsnitsel@redhat.com, ml.linux@elloe.vision,
        linux-integrity@vger.kernel.org, linux-kernel@vger.kernel.org,
        LinoSanfilippo@gmx.de
Subject: [PATCH v2 4/4] tpm: Only enable supported irqs
Date:   Mon, 26 Apr 2021 01:47:20 +0200
Message-Id: <1619394440-30646-5-git-send-email-LinoSanfilippo@gmx.de>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1619394440-30646-1-git-send-email-LinoSanfilippo@gmx.de>
References: <1619394440-30646-1-git-send-email-LinoSanfilippo@gmx.de>
MIME-Version: 1.0
Content-Transfer-Encoding: base64
X-Provags-ID: V03:K1:wf/64QakyOSI9jz7hqW6GXOuWs1J1FwaBQkKckxcviqtBU8ZK1y
 zA5UQZLFz/ULemAfOLt7bq2akATaZlig1v2w13YvE3RpF5+mqU8U4CPMZ2hVOxzAKaCR/jE
 1gus6NulyZBu+rjpb3NKj6DKv1pxwBovdmaEypOtyHG0DUcJ3dy4ECRpBC80J2VFaiL/kwg
 lP0Hy+CHjZEerdg/KvMSg==
X-Spam-Flag: NO
X-UI-Out-Filterresults: notjunk:1;V03:K0:KgZg+tIMjoU=:j5zcQjOmFw2zlPtkwIDG3S
 hqKSLO+/KoKIAmAEpwB7HZGKSZs8MIkANWQ/ag5OD9qsVVOKqX7/Ti4wxG67/eXdzJi92TLb3
 De0Bqbo6a0YAGeYesJ+W6Hnf1mdD/fyjWmpq0wwkVbdUibtEyFqnoXfm1cUkU5HOCnf6mlvbD
 KRkRqAELLbfO6ANj7mujHNfvITQ/n4HeDLTo4To1Guo0pjTLdBp3BwgJwHASuThi8P59rSVPF
 5NuvSbDLwEC+8NI27tPHx7GMiRq9E56+GsK0WNczDZN7B5XhU2rgPTOY2zr6uLNbxIKzkyQKE
 Po0woTSbG6WXqOcd32fGxvq5uSiyKTuep6uKbedbZfiPWiyMf4VVYbFrw9Yrl9JViDRs500Fc
 WGJUo3ruCpi8K9VCpZgjskv+4F5C+OV9ISKIzvJ+ijC1PRi9g5W5/JJGcOl+EQ/1WUOsj7smx
 quQoU26UCh/HNBuKEMyKUDvMD2b6+6T3TYrwhLiAsmYU55w3boBrTv3CaB8ph6T+VWKO5Ewm9
 wrQ3pIySuiPw0qG+cVyZKw16jew8ZGh19+ku6jHRAuzO5yC0i8hz77OCfkptCTG4P0FwVhLqD
 WPMD6zVtNzu7Y25YHkQvrHjUrjtj+3hZBZCr0WoKGBdDBhgWGvw1aizbDkEWM/uAtmqUje/ly
 avp4H8agH2/tSua88KQBXwlAXYfRe/OSJmMZxbdu2kUFK2evsDMbdQwol0F7QE3fPrw963yDW
 WZ+lQRLBP1F0qvPwTAfw4/tTcWLYMgeSIK2nW352QZ3o7JbZUuBytw3P46NMy3xuyqEr92Jkh
 invyVcRCH9A5ddQ0zLdpfNG7BqNrZzCdWil9r2hq8JFZVcHQ9+B1R0cYRNo/+936gjrDbCT9o
 R9kKlBkCb/h7h7CErq9pZ0ztW1tczYrfk5IwzBZffIreTKKq0lk8dkYsMDwna360p93HblBNC
 vY0qzcOBKZSE9mY3Iak5+xp7T8KMVQ1p+vFYHTM6KXwxK/QeUVzJAE0TnrV1OT6Bwoo8fE9Rr
 8BwtKwG9jgObDOplqUvy5JL/99TZu76ogOwCk64AIg/DjqIhxd7T5nDS8vIEfKC/896vOM4cI
 3XMb2Jo4Dt0S3iHyJnuNFm/s1F4oCCooucdWcUFLQNpCNvLJdm7lh3LDpWTOgEZsBRX+jK+Yc
 eatU+T6WDnEXetkQ1VanVxw1F1ZNBA5v1PwYuFWn6EtbpX/Qv75bjKmpPZmhqjJNclZfzKRJ5
 QTNET2xnGtXrZ89Tp
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

RG8gbm90IHNldCBpbnRlcnJ1cHRzIHdoaWNoIGFyZSBub3Qgc3VwcG9ydGVkIGJ5IHRoZSBoYXJk
d2FyZS4gSW5zdGVhZCB1c2UKdGhlIGluZm9ybWF0aW9uIGZyb20gdGhlIGNhcGFiaWxpdHkgcXVl
cnkgYW5kIGFjdGl2YXRlIG9ubHkgdGhlIHJlcG9ydGVkCmludGVycnVwdHMuCgpTaWduZWQtb2Zm
LWJ5OiBMaW5vIFNhbmZpbGlwcG8gPExpbm9TYW5maWxpcHBvQGdteC5kZT4KLS0tCiBkcml2ZXJz
L2NoYXIvdHBtL3RwbV90aXNfY29yZS5jIHwgNjggKysrKysrKysrKysrKysrKysrKysrKy0tLS0t
LS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmggfCAgMSArCiAy
IGZpbGVzIGNoYW5nZWQsIDM4IGluc2VydGlvbnMoKyksIDMxIGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmMgYi9kcml2ZXJzL2NoYXIvdHBt
L3RwbV90aXNfY29yZS5jCmluZGV4IGU4YWIyMTguLjdiMDAxNjEgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmMKKysrIGIvZHJpdmVycy9jaGFyL3RwbS90cG1fdGlz
X2NvcmUuYwpAQCAtOTgwLDEzICs5ODAsNDcgQEAgaW50IHRwbV90aXNfY29yZV9pbml0KHN0cnVj
dCBkZXZpY2UgKmRldiwgc3RydWN0IHRwbV90aXNfZGF0YSAqcHJpdiwgaW50IGlycSwKIAlpZiAo
cmMpCiAJCWdvdG8gb3V0X2VycjsKIAorCS8qIEZpZ3VyZSBvdXQgdGhlIGNhcGFiaWxpdGllcyAq
LworCXJjID0gdHBtX3Rpc19yZWFkMzIocHJpdiwgVFBNX0lOVEZfQ0FQUyhwcml2LT5sb2NhbGl0
eSksICZpbnRmY2Fwcyk7CisJaWYgKHJjIDwgMCkKKwkJZ290byBvdXRfZXJyOworCisJZGV2X2Ri
ZyhkZXYsICJUUE0gaW50ZXJmYWNlIGNhcGFiaWxpdGllcyAoMHgleCk6XG4iLAorCQlpbnRmY2Fw
cyk7CisJaWYgKGludGZjYXBzICYgVFBNX0lOVEZfQlVSU1RfQ09VTlRfU1RBVElDKQorCQlkZXZf
ZGJnKGRldiwgIlx0QnVyc3QgQ291bnQgU3RhdGljXG4iKTsKKwlpZiAoaW50ZmNhcHMgJiBUUE1f
SU5URl9DTURfUkVBRFlfSU5UKSB7CisJCXByaXYtPnN1cHBvcnRlZF9pcnFzIHw9IFRQTV9JTlRG
X0NNRF9SRUFEWV9JTlQ7CisJCWRldl9kYmcoZGV2LCAiXHRDb21tYW5kIFJlYWR5IEludCBTdXBw
b3J0XG4iKTsKKwl9CisJaWYgKGludGZjYXBzICYgVFBNX0lOVEZfSU5UX0VER0VfRkFMTElORykK
KwkJZGV2X2RiZyhkZXYsICJcdEludGVycnVwdCBFZGdlIEZhbGxpbmdcbiIpOworCWlmIChpbnRm
Y2FwcyAmIFRQTV9JTlRGX0lOVF9FREdFX1JJU0lORykKKwkJZGV2X2RiZyhkZXYsICJcdEludGVy
cnVwdCBFZGdlIFJpc2luZ1xuIik7CisJaWYgKGludGZjYXBzICYgVFBNX0lOVEZfSU5UX0xFVkVM
X0xPVykKKwkJZGV2X2RiZyhkZXYsICJcdEludGVycnVwdCBMZXZlbCBMb3dcbiIpOworCWlmIChp
bnRmY2FwcyAmIFRQTV9JTlRGX0lOVF9MRVZFTF9ISUdIKQorCQlkZXZfZGJnKGRldiwgIlx0SW50
ZXJydXB0IExldmVsIEhpZ2hcbiIpOworCWlmIChpbnRmY2FwcyAmIFRQTV9JTlRGX0xPQ0FMSVRZ
X0NIQU5HRV9JTlQpIHsKKwkJcHJpdi0+c3VwcG9ydGVkX2lycXMgfD0gVFBNX0lOVEZfTE9DQUxJ
VFlfQ0hBTkdFX0lOVDsKKwkJZGV2X2RiZyhkZXYsICJcdExvY2FsaXR5IENoYW5nZSBJbnQgU3Vw
cG9ydFxuIik7CisJfQorCWlmIChpbnRmY2FwcyAmIFRQTV9JTlRGX1NUU19WQUxJRF9JTlQpIHsK
KwkJcHJpdi0+c3VwcG9ydGVkX2lycXMgfD0gVFBNX0lOVEZfU1RTX1ZBTElEX0lOVDsKKwkJZGV2
X2RiZyhkZXYsICJcdFN0cyBWYWxpZCBJbnQgU3VwcG9ydFxuIik7CisJfQorCWlmIChpbnRmY2Fw
cyAmIFRQTV9JTlRGX0RBVEFfQVZBSUxfSU5UKSB7CisJCXByaXYtPnN1cHBvcnRlZF9pcnFzIHw9
IFRQTV9JTlRGX0RBVEFfQVZBSUxfSU5UOworCQlkZXZfZGJnKGRldiwgIlx0RGF0YSBBdmFpbCBJ
bnQgU3VwcG9ydFxuIik7CisJfQorCiAJLyogVGFrZSBjb250cm9sIG9mIHRoZSBUUE0ncyBpbnRl
cnJ1cHQgaGFyZHdhcmUgYW5kIHNodXQgaXQgb2ZmICovCiAJcmMgPSB0cG1fdGlzX3JlYWQzMihw
cml2LCBUUE1fSU5UX0VOQUJMRShwcml2LT5sb2NhbGl0eSksICZpbnRtYXNrKTsKIAlpZiAocmMg
PCAwKQogCQlnb3RvIG91dF9lcnI7CiAKLQlpbnRtYXNrIHw9IFRQTV9JTlRGX0NNRF9SRUFEWV9J
TlQgfCBUUE1fSU5URl9MT0NBTElUWV9DSEFOR0VfSU5UIHwKLQkJICAgVFBNX0lOVEZfREFUQV9B
VkFJTF9JTlQgfCBUUE1fSU5URl9TVFNfVkFMSURfSU5UOworCWludG1hc2sgfD0gcHJpdi0+c3Vw
cG9ydGVkX2lycXM7CisKIAlpbnRtYXNrICY9IH5UUE1fR0xPQkFMX0lOVF9FTkFCTEU7CiAJdHBt
X3Rpc193cml0ZTMyKHByaXYsIFRQTV9JTlRfRU5BQkxFKHByaXYtPmxvY2FsaXR5KSwgaW50bWFz
ayk7CiAKQEAgLTEwMTUsMzIgKzEwNDksNiBAQCBpbnQgdHBtX3Rpc19jb3JlX2luaXQoc3RydWN0
IGRldmljZSAqZGV2LCBzdHJ1Y3QgdHBtX3Rpc19kYXRhICpwcml2LCBpbnQgaXJxLAogCQlnb3Rv
IG91dF9lcnI7CiAJfQogCi0JLyogRmlndXJlIG91dCB0aGUgY2FwYWJpbGl0aWVzICovCi0JcmMg
PSB0cG1fdGlzX3JlYWQzMihwcml2LCBUUE1fSU5URl9DQVBTKHByaXYtPmxvY2FsaXR5KSwgJmlu
dGZjYXBzKTsKLQlpZiAocmMgPCAwKQotCQlnb3RvIG91dF9lcnI7Ci0KLQlkZXZfZGJnKGRldiwg
IlRQTSBpbnRlcmZhY2UgY2FwYWJpbGl0aWVzICgweCV4KTpcbiIsCi0JCWludGZjYXBzKTsKLQlp
ZiAoaW50ZmNhcHMgJiBUUE1fSU5URl9CVVJTVF9DT1VOVF9TVEFUSUMpCi0JCWRldl9kYmcoZGV2
LCAiXHRCdXJzdCBDb3VudCBTdGF0aWNcbiIpOwotCWlmIChpbnRmY2FwcyAmIFRQTV9JTlRGX0NN
RF9SRUFEWV9JTlQpCi0JCWRldl9kYmcoZGV2LCAiXHRDb21tYW5kIFJlYWR5IEludCBTdXBwb3J0
XG4iKTsKLQlpZiAoaW50ZmNhcHMgJiBUUE1fSU5URl9JTlRfRURHRV9GQUxMSU5HKQotCQlkZXZf
ZGJnKGRldiwgIlx0SW50ZXJydXB0IEVkZ2UgRmFsbGluZ1xuIik7Ci0JaWYgKGludGZjYXBzICYg
VFBNX0lOVEZfSU5UX0VER0VfUklTSU5HKQotCQlkZXZfZGJnKGRldiwgIlx0SW50ZXJydXB0IEVk
Z2UgUmlzaW5nXG4iKTsKLQlpZiAoaW50ZmNhcHMgJiBUUE1fSU5URl9JTlRfTEVWRUxfTE9XKQot
CQlkZXZfZGJnKGRldiwgIlx0SW50ZXJydXB0IExldmVsIExvd1xuIik7Ci0JaWYgKGludGZjYXBz
ICYgVFBNX0lOVEZfSU5UX0xFVkVMX0hJR0gpCi0JCWRldl9kYmcoZGV2LCAiXHRJbnRlcnJ1cHQg
TGV2ZWwgSGlnaFxuIik7Ci0JaWYgKGludGZjYXBzICYgVFBNX0lOVEZfTE9DQUxJVFlfQ0hBTkdF
X0lOVCkKLQkJZGV2X2RiZyhkZXYsICJcdExvY2FsaXR5IENoYW5nZSBJbnQgU3VwcG9ydFxuIik7
Ci0JaWYgKGludGZjYXBzICYgVFBNX0lOVEZfU1RTX1ZBTElEX0lOVCkKLQkJZGV2X2RiZyhkZXYs
ICJcdFN0cyBWYWxpZCBJbnQgU3VwcG9ydFxuIik7Ci0JaWYgKGludGZjYXBzICYgVFBNX0lOVEZf
REFUQV9BVkFJTF9JTlQpCi0JCWRldl9kYmcoZGV2LCAiXHREYXRhIEF2YWlsIEludCBTdXBwb3J0
XG4iKTsKLQogCS8qIElOVEVSUlVQVCBTZXR1cCAqLwogCWluaXRfd2FpdHF1ZXVlX2hlYWQoJnBy
aXYtPnJlYWRfcXVldWUpOwogCWluaXRfd2FpdHF1ZXVlX2hlYWQoJnByaXYtPmludF9xdWV1ZSk7
CkBAIC0xMTEwLDkgKzExMTgsNyBAQCBzdGF0aWMgdm9pZCB0cG1fdGlzX3JlZW5hYmxlX2ludGVy
cnVwdHMoc3RydWN0IHRwbV9jaGlwICpjaGlwKQogCWlmIChyYyA8IDApCiAJCWdvdG8gb3V0Owog
Ci0JaW50bWFzayB8PSBUUE1fSU5URl9DTURfUkVBRFlfSU5UCi0JICAgIHwgVFBNX0lOVEZfTE9D
QUxJVFlfQ0hBTkdFX0lOVCB8IFRQTV9JTlRGX0RBVEFfQVZBSUxfSU5UCi0JICAgIHwgVFBNX0lO
VEZfU1RTX1ZBTElEX0lOVCB8IFRQTV9HTE9CQUxfSU5UX0VOQUJMRTsKKwlpbnRtYXNrIHw9IGNo
aXAtPnN1cHBvcnRlZF9pcnFzIHwgVFBNX0dMT0JBTF9JTlRfRU5BQkxFOwogCiAJdHBtX3Rpc193
cml0ZTMyKHByaXYsIFRQTV9JTlRfRU5BQkxFKHByaXYtPmxvY2FsaXR5KSwgaW50bWFzayk7CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmggYi9kcml2ZXJzL2No
YXIvdHBtL3RwbV90aXNfY29yZS5oCmluZGV4IGRjNWY5MmIuLjhmZjYyMjEzIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2NoYXIvdHBtL3RwbV90aXNfY29yZS5oCisrKyBiL2RyaXZlcnMvY2hhci90cG0v
dHBtX3Rpc19jb3JlLmgKQEAgLTg5LDYgKzg5LDcgQEAgc3RydWN0IHRwbV90aXNfZGF0YSB7CiAJ
dTE2IG1hbnVmYWN0dXJlcl9pZDsKIAlpbnQgbG9jYWxpdHk7CiAJaW50IGlycTsKKwl1bnNpZ25l
ZCBpbnQgc3VwcG9ydGVkX2lycXM7CiAJdW5zaWduZWQgaW50IGZsYWdzOwogCXZvaWQgX19pb21l
bSAqaWxiX2Jhc2VfYWRkcjsKIAl1MTYgY2xrcnVuX2VuYWJsZWQ7Ci0tIAoyLjcuNAoK
