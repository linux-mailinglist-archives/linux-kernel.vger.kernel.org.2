Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 86392320ED1
	for <lists+linux-kernel@lfdr.de>; Mon, 22 Feb 2021 02:00:47 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S230073AbhBVA65 (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Sun, 21 Feb 2021 19:58:57 -0500
Received: from mout.gmx.net ([212.227.17.20]:35431 "EHLO mout.gmx.net"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S229891AbhBVA6q (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 21 Feb 2021 19:58:46 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=gmx.net;
        s=badeba3b8450; t=1613955422;
        bh=KldllQqhDQL9+GWSK9i/UXP1sLnnx5QAIr+tuAEKPEQ=;
        h=X-UI-Sender-Class:From:To:Cc:Subject:Date:In-Reply-To:References;
        b=IISjMkSZYJ/BQd0Z7oM56Tqmao8uZg6BNcJdoMBusoWELtKnfsT9waooXWvgPnx7o
         sMAytXoVMeW0SxtvKQE1gw65bzDjZtvHrRom1ImVNtfZin7myGmyqq1PtNsoGfaWEW
         ncBOjSRaIly1XhWlbfrPWhlHYipfIlHHSRXzFBQc=
X-UI-Sender-Class: 01bb95c1-4bf8-414a-932a-4f6e2808ef9c
Received: from Venus.fritz.box ([78.42.220.31]) by mail.gmx.net (mrgmx104
 [212.227.17.168]) with ESMTPSA (Nemesis) id 1MNbox-1lSf1q3mNX-00P5er; Mon, 22
 Feb 2021 01:57:01 +0100
From:   Lino Sanfilippo <LinoSanfilippo@gmx.de>
To:     peterhuewe@gmx.de, jarkko@kernel.org, jgg@ziepe.ca
Cc:     stefanb@linux.vnet.ibm.com, James.Bottomley@hansenpartnership.com,
        jsnitsel@redhat.com, linux-integrity@vger.kernel.org,
        linux-kernel@vger.kernel.org, LinoSanfilippo@gmx.de
Subject: [PATCH 2/4] tpm: get locality before writing to TPM chip
Date:   Mon, 22 Feb 2021 01:56:32 +0100
Message-Id: <1613955394-13152-3-git-send-email-LinoSanfilippo@gmx.de>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1613955394-13152-1-git-send-email-LinoSanfilippo@gmx.de>
References: <1613955394-13152-1-git-send-email-LinoSanfilippo@gmx.de>
MIME-Version: 1.0
Content-Transfer-Encoding: base64
X-Provags-ID: V03:K1:qhd9aPZ4LJcyp5V8EhU0ldbf11gT8fnTKkM/Vdq24uW5oDFQ3II
 Cjns7qqqV/hk4wg9xlPg5+inKALszOvSh17e6U3qnsxj3hY1zMNvmGMFlz34+R7a1UlKGEN
 pIfKno1oSZ0Zy5ZSy4aAmtp3GfS0V4Gq7sdpp1bjhvsy5XhDzwsoSpWZsyLiS/1Vi2PYRl7
 iosWYrNhNEiUH8GqNH+8A==
X-Spam-Flag: NO
X-UI-Out-Filterresults: notjunk:1;V03:K0:p0ymXvUTRh0=:sipArUs8ttHnIG0q0jbw0U
 PBqR52bw/HPfv5QazMqVuh/ZlQHvsMNgToZ59GN1KeUV8tx5FQ6qAYB1HROlm5WwpG3l/ayig
 KdNF4AFh+psftOcSPaiqFEvXC5wC7wiXTJL091Yy8bCbmoghmoB4AWJci4+fFTA2iSDbjYcMZ
 MtICnWxCHtpjYKWK3X19xXTyD1kfYOnvK4a1y6J4ZE7jxhJNljarX8DQG//HmXwdyzNn8dhcD
 ibPX92/2nSswvOrPpKy5CyK+l8gbqIjGpsq8Uwl6uryWuVUhGibIoLK27Uamt17ZiLavj0s8r
 7K+DDEdw8sVpCJNmGw0DISanikrBb/EU98/ZGYZtbMmiEU2o7/sg+4bmjpNp6IxL+riFIzZFD
 +KUM5LDsAWmIwyp2K0I9VFall8Fxnot9geWvrzeKKMimhGRPufFzO92WpGJEc8xfFzDe26mrF
 r9TSsWZ3ol7XVU1nBHq5VV5BUYfKDc+j0g0MZuEGdqAEJQn0qGZZbYiAhMNGLheGcbYRyT2sb
 mY688P8hhkyE0Vm4MHX1KKVNicM32c5vH+3SDwh2CcKlOpqME5PuQha8+ZVFVWfWZXm94B3rl
 tDbvCtUQXlfC6DsaUaFIEA1/SK9o51Iq2yoZvzYtvn4ekoBwC9+hZ5hMxVEsqJg6JyuRDC0gK
 O03FR6N6akZvIMvWkkpyeZ7LLH11xxOLMSF/UPWACcWIWdHUQ9bLBk5PBiI5L7vbUe/t9bRPJ
 5XunRGmQag38RAIGLjZZzO/qObVYDKK3PAaG7bBhFK4JpIkz9ViM8YawK4eVmXBSvuCKeMTiO
 ZFuluBWsww+EBQduIUkwr/1+EFOgvb/QOvs2+1TwPoS8nqV5B2R64AJdEpawP5PSHebrqq8qf
 Ux/3FTdBQ7KlI0TSIYfA==
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

V2hlbiBydW5uaW5nIHdpdGggVFBNIGNoaXBzIGxpa2UgdGhlIFNMQiA5NjcwVlEyLjAgdGhlIFRQ
TSBkcml2ZXJzIHByb2JlCmZ1bmN0aW9uIHByaW50cyB0aGUgZm9sbG93aW5nIHdhcm5pbmc6CgpU
UE0gcmV0dXJuZWQgaW52YWxpZCBzdGF0dXMKV0FSTklORzogQ1BVOiAzIFBJRDogMTQxNiBhdCBk
cml2ZXJzL2NoYXIvdHBtL3RwbV90aXNfY29yZS5jOjI0OSB0cG1fdGlzX3N0YXR1cysweGJjLzB4
YzggW3RwbV90aXNfY29yZV0KTW9kdWxlcyBsaW5rZWQgaW46IHRwbV90aXNfc3BpIHRwbV90aXNf
Y29yZSB0cG0gc3BpX2JjbTI4MzUgc2hhMjU2X2dlbmVyaWMgY2ZnODAyMTEgcmZraWxsIDgwMjFx
IGdhcnAgc3RwIGxsYyBzcGlkZXYgdjNkIGdwdV9zY2hlZCByYXNwYmVycnlwaV9od21vbiB2YzQg
Y2VjIGRybV9rbXNfaGVscGVyIGJjbTI4MzVfY29kZWMoQykgZHJtIHY0bDJfbWVtMm1lbSBkcm1f
cGFuZWxfb3JpZW50YXRpb25fcXVpcmtzIGJjbTI4MzVfdjRsMihDKSBiY20yODM1X2lzcChDKSB2
aWRlb2J1ZjJfZG1hX2NvbnRpZyBzbmRfc29jX2NvcmUgYmNtMjgzNV9tbWFsX3ZjaGlxKEMpIHNu
ZF9iY20yODM1KEMpIHZpZGVvYnVmMl92bWFsbG9jIHNuZF9jb21wcmVzcyB2aWRlb2J1ZjJfbWVt
b3BzIHZpZGVvYnVmMl92NGwyIHNuZF9wY21fZG1hZW5naW5lIHZpZGVvYnVmMl9jb21tb24gc25k
X3BjbSBzbmRfdGltZXIgdmlkZW9kZXYgdmNfc21fY21hKEMpIG1jIHNuZCBzeXNjb3B5YXJlYSBz
eXNmaWxscmVjdCBzeXNpbWdibHQgZmJfc3lzX2ZvcHMgYmFja2xpZ2h0IHJwaXZpZF9tZW0gdWlv
X3BkcnZfZ2VuaXJxIHVpbyBpcF90YWJsZXMgeF90YWJsZXMgaXB2NiBbbGFzdCB1bmxvYWRlZDog
dHBtXQpDUFU6IDMgUElEOiAxNDE2IENvbW06IGt3b3JrZXIvdTg6MiBUYWludGVkOiBHICAgICAg
ICBXQyAgICAgICAgNS4xMC41LUxTLUhPTUUrICMxCkhhcmR3YXJlIG5hbWU6IFJhc3BiZXJyeSBQ
aSBDb21wdXRlIE1vZHVsZSA0IFJldiAxLjAgKERUKQpXb3JrcXVldWU6IGV2ZW50c191bmJvdW5k
IGFzeW5jX3J1bl9lbnRyeV9mbgpwc3RhdGU6IDgwMDAwMDA1IChOemN2IGRhaWYgLVBBTiAtVUFP
IC1UQ08gQlRZUEU9LS0pCnBjIDogdHBtX3Rpc19zdGF0dXMrMHhiYy8weGM4IFt0cG1fdGlzX2Nv
cmVdCmxyIDogdHBtX3Rpc19zdGF0dXMrMHhiYy8weGM4IFt0cG1fdGlzX2NvcmVdCnNwIDogZmZm
ZmZmYzAxMjBhMzhmMAp4Mjk6IGZmZmZmZmMwMTIwYTM4ZjAgeDI4OiBmZmZmZmZjMDExMjM4MDAw
CngyNzogMDAwMDAwMDAwMDAwMDAxNiB4MjY6IDAwMDAwMDAwMDAwMDAxN2EKeDI1OiAwMDAwMDAw
MDAwMDAwMDE0IHgyNDogZmZmZmZmODA0OTdmOTAwMAp4MjM6IDAwMDAwMDAwMDAwMDAwMDAgeDIy
OiAwMDAwMDAwMDAwMDAwMDE2CngyMTogZmZmZmZmODA0NTY4MDA4MCB4MjA6IDAwMDAwMDAwMDAw
MDAwMDAKeDE5OiBmZmZmZmZjMDExMjM4MDAwIHgxODogZmZmZmZmYzAxMTIzODk0OAp4MTc6IDAw
MDAwMDAwMDAwMDAwMDAgeDE2OiAwMDAwMDAwMDAwMDAwMDAwCngxNTogZmZmZmZmYzAxMTQzN2M1
MCB4MTQ6IGZmZmZmZmZmZmZmZmZmZmYKeDEzOiBmZmZmZmZjMDExNDM3OGE2IHgxMjogZmZmZmZm
ZmZmZmZmZmZmZgp4MTE6IGZmZmZmZjgwN2ZiZGU1ZjAgeDEwOiAwMDAwMDAwMDAwMDAwMDA3Cng5
IDogZmZmZmZmYzAxMjBhMzhmMCB4OCA6IDYxNzQ3MzIwNjQ2OTZjNjEKeDcgOiAwMDAwMDAwMDAw
MDAwMDAwIHg2IDogZmZmZmZmYzAxMTIzOTAwMAp4NSA6IGZmZmZmZjgwN2ZiYzc4ZTAgeDQgOiAw
MDAwMDAwMDAwMDAwMDAwCngzIDogMDAwMDAwMDAwMDAwMDAyNyB4MiA6IDAwMDAwMDAwMDAwMDAw
MDAKeDEgOiA2NzBjNTQ3N2Y0NDgzMjAwIHgwIDogMDAwMDAwMDAwMDAwMDAwMApDYWxsIHRyYWNl
Ogp0cG1fdGlzX3N0YXR1cysweGJjLzB4YzggW3RwbV90aXNfY29yZV0KdHBtX3Rpc19zZW5kX2Rh
dGErMHg1OC8weDI1MCBbdHBtX3Rpc19jb3JlXQp0cG1fdGlzX3NlbmRfbWFpbisweDUwLzB4MTI4
IFt0cG1fdGlzX2NvcmVdCnRwbV90aXNfc2VuZCsweDRjLzB4MTI4IFt0cG1fdGlzX2NvcmVdCnRw
bV90cmFuc21pdCsweGQwLzB4MzUwIFt0cG1dCnRwbV90cmFuc21pdF9jbWQrMHgzYy8weGMwIFt0
cG1dCnRwbTJfZ2V0X3RwbV9wdCsweDEyNC8weDFlOCBbdHBtXQp0cG1fdGlzX3Byb2JlX2lycV9z
aW5nbGUrMHgxN2MvMHgzODggW3RwbV90aXNfY29yZV0KdHBtX3Rpc19jb3JlX2luaXQrMHgyZTAv
MHg0ZjggW3RwbV90aXNfY29yZV0KdHBtX3Rpc19zcGlfaW5pdCsweDVjLzB4NzggW3RwbV90aXNf
c3BpXQp0cG1fdGlzX3NwaV9wcm9iZSsweDgwLzB4OTggW3RwbV90aXNfc3BpXQp0cG1fdGlzX3Nw
aV9kcml2ZXJfcHJvYmUrMHg0Yy8weDYwIFt0cG1fdGlzX3NwaV0Kc3BpX2Rydl9wcm9iZSsweDg0
LzB4ZjAKcmVhbGx5X3Byb2JlKzB4MTE4LzB4NDIwCmRyaXZlcl9wcm9iZV9kZXZpY2UrMHg1Yy8w
eGMwCl9fZHJpdmVyX2F0dGFjaF9hc3luY19oZWxwZXIrMHg2NC8weDY4CmFzeW5jX3J1bl9lbnRy
eV9mbisweDQ4LzB4MTUwCnByb2Nlc3Nfb25lX3dvcmsrMHgxNWMvMHg0ZDAKd29ya2VyX3RocmVh
ZCsweDUwLzB4NDkwCmt0aHJlYWQrMHgxMTgvMHgxNTAKcmV0X2Zyb21fZm9yaysweDEwLzB4MTgK
LS0tWyBlbmQgdHJhY2UgMjA5Yzg2ODE1Y2QxNWVhYiBdLS0tCgpUaGUgcmVhc29uIGlzIHRoZSBh
dHRlbXB0IHRvIHJlYWQgVFBNIDIuMCBwcm9wZXJ0aWVzIGZyb20gdGhlIGhhcmR3YXJlCndoaWxl
IHRoZSBjb25jZXJuaW5nIGxvY2FsaXR5IGhhcyBub3QgYmVlbiBtYWludGFpbmVkIGJlZm9yZS4K
ClRvIGF2b2lkIHRoaXMgaXNzdWUgYW5kIHRoZSBuZWVkIHRvIHJlcXVlc3QgYW5kIHJlbGVhc2Ug
dGhlIGxvY2FsaXR5Cm11bHRpcGxlIHRpbWVzIGR1cmluZyBkcml2ZXIgaW5pdGlhbGl6YXRpb24s
IGFuZCBzaW5jZSB0aGUgZHJpdmVyIG9ubHkKc3VwcG9ydHMgdGhlIGxlZ2FjeSBsb2NhbGl0eSAw
LCByZXF1ZXN0IGl0IG9uY2UgYXQgZHJpdmVyIHN0YXJ0dXAKYW5kIG9ubHkgcmVsZWFzZSBpdCBh
dCBkcml2ZXIgc2h1dGRvd24uCgpTaWduZWQtb2ZmLWJ5OiBMaW5vIFNhbmZpbGlwcG8gPExpbm9T
YW5maWxpcHBvQGdteC5kZT4KLS0tCiBkcml2ZXJzL2NoYXIvdHBtL3RwbS1jaGlwLmMgICAgIHwg
MTAgLS0tLS0tLS0tLQogZHJpdmVycy9jaGFyL3RwbS90cG1fdGlzX2NvcmUuYyB8IDE2ICsrKysr
KysrKy0tLS0tLS0KIDIgZmlsZXMgY2hhbmdlZCwgOSBpbnNlcnRpb25zKCspLCAxNyBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2NoYXIvdHBtL3RwbS1jaGlwLmMgYi9kcml2ZXJz
L2NoYXIvdHBtL3RwbS1jaGlwLmMKaW5kZXggZGRhZWNlYi4uNWViNjNmMiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9jaGFyL3RwbS90cG0tY2hpcC5jCisrKyBiL2RyaXZlcnMvY2hhci90cG0vdHBtLWNo
aXAuYwpAQCAtMTAzLDE3ICsxMDMsOCBAQCBpbnQgdHBtX2NoaXBfc3RhcnQoc3RydWN0IHRwbV9j
aGlwICpjaGlwKQogCiAJdHBtX2Nsa19lbmFibGUoY2hpcCk7CiAKLQlpZiAoY2hpcC0+bG9jYWxp
dHkgPT0gLTEpIHsKLQkJcmV0ID0gdHBtX3JlcXVlc3RfbG9jYWxpdHkoY2hpcCk7Ci0JCWlmIChy
ZXQpIHsKLQkJCXRwbV9jbGtfZGlzYWJsZShjaGlwKTsKLQkJCXJldHVybiByZXQ7Ci0JCX0KLQl9
Ci0KIAlyZXQgPSB0cG1fY21kX3JlYWR5KGNoaXApOwogCWlmIChyZXQpIHsKLQkJdHBtX3JlbGlu
cXVpc2hfbG9jYWxpdHkoY2hpcCk7CiAJCXRwbV9jbGtfZGlzYWJsZShjaGlwKTsKIAkJcmV0dXJu
IHJldDsKIAl9CkBAIC0xMzMsNyArMTI0LDYgQEAgRVhQT1JUX1NZTUJPTF9HUEwodHBtX2NoaXBf
c3RhcnQpOwogdm9pZCB0cG1fY2hpcF9zdG9wKHN0cnVjdCB0cG1fY2hpcCAqY2hpcCkKIHsKIAl0
cG1fZ29faWRsZShjaGlwKTsKLQl0cG1fcmVsaW5xdWlzaF9sb2NhbGl0eShjaGlwKTsKIAl0cG1f
Y2xrX2Rpc2FibGUoY2hpcCk7CiB9CiBFWFBPUlRfU1lNQk9MX0dQTCh0cG1fY2hpcF9zdG9wKTsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmMgYi9kcml2ZXJzL2No
YXIvdHBtL3RwbV90aXNfY29yZS5jCmluZGV4IDJjOTU2YTEuLmUyZjg1ODUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvY2hhci90cG0vdHBtX3Rpc19jb3JlLmMKKysrIGIvZHJpdmVycy9jaGFyL3RwbS90
cG1fdGlzX2NvcmUuYwpAQCAtNjcwLDkgKzY3MCw2IEBAIHN0YXRpYyBpbnQgcHJvYmVfaXRwbShz
dHJ1Y3QgdHBtX2NoaXAgKmNoaXApCiAJaWYgKHZlbmRvciAhPSBUUE1fVklEX0lOVEVMKQogCQly
ZXR1cm4gMDsKIAotCWlmIChyZXF1ZXN0X2xvY2FsaXR5KGNoaXAsIDApICE9IDApCi0JCXJldHVy
biAtRUJVU1k7Ci0KIAlyYyA9IHRwbV90aXNfc2VuZF9kYXRhKGNoaXAsIGNtZF9nZXR0aWNrcywg
bGVuKTsKIAlpZiAocmMgPT0gMCkKIAkJZ290byBvdXQ7CkBAIC02OTEsNyArNjg4LDYgQEAgc3Rh
dGljIGludCBwcm9iZV9pdHBtKHN0cnVjdCB0cG1fY2hpcCAqY2hpcCkKIAogb3V0OgogCXRwbV90
aXNfcmVhZHkoY2hpcCk7Ci0JcmVsZWFzZV9sb2NhbGl0eShjaGlwLCBwcml2LT5sb2NhbGl0eSk7
CiAKIAlyZXR1cm4gcmM7CiB9CkBAIC04NzAsNiArODY2LDcgQEAgdm9pZCB0cG1fdGlzX3JlbW92
ZShzdHJ1Y3QgdHBtX2NoaXAgKmNoaXApCiAKIAl0cG1fdGlzX3dyaXRlMzIocHJpdiwgcmVnLCB+
VFBNX0dMT0JBTF9JTlRfRU5BQkxFICYgaW50ZXJydXB0KTsKIAorCXJlbGVhc2VfbG9jYWxpdHko
Y2hpcCwgMCk7CiAJdHBtX3Rpc19jbGtydW5fZW5hYmxlKGNoaXAsIGZhbHNlKTsKIAogCWlmIChw
cml2LT5pbGJfYmFzZV9hZGRyKQpAQCAtOTk3LDYgKzk5NCwxNCBAQCBpbnQgdHBtX3Rpc19jb3Jl
X2luaXQoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgdHBtX3Rpc19kYXRhICpwcml2LCBpbnQg
aXJxLAogCQlnb3RvIG91dF9lcnI7CiAJfQogCisJcmMgPSByZXF1ZXN0X2xvY2FsaXR5KGNoaXAs
IDApOworCWlmIChyYykKKwkJZ290byBvdXRfZXJyOworCisJcmMgPSB0cG1fY2hpcF9zdGFydChj
aGlwKTsKKwlpZiAocmMpCisJCWdvdG8gb3V0X2VycjsKKwogCS8qIFRha2UgY29udHJvbCBvZiB0
aGUgVFBNJ3MgaW50ZXJydXB0IGhhcmR3YXJlIGFuZCBzaHV0IGl0IG9mZiAqLwogCXJjID0gdHBt
X3Rpc19yZWFkMzIocHJpdiwgVFBNX0lOVF9FTkFCTEUocHJpdi0+bG9jYWxpdHkpLCAmaW50bWFz
ayk7CiAJaWYgKHJjIDwgMCkKQEAgLTEwMDcsOSArMTAxMiw2IEBAIGludCB0cG1fdGlzX2NvcmVf
aW5pdChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCB0cG1fdGlzX2RhdGEgKnByaXYsIGludCBp
cnEsCiAJaW50bWFzayAmPSB+VFBNX0dMT0JBTF9JTlRfRU5BQkxFOwogCXRwbV90aXNfd3JpdGUz
Mihwcml2LCBUUE1fSU5UX0VOQUJMRShwcml2LT5sb2NhbGl0eSksIGludG1hc2spOwogCi0JcmMg
PSB0cG1fY2hpcF9zdGFydChjaGlwKTsKLQlpZiAocmMpCi0JCWdvdG8gb3V0X2VycjsKIAlyYyA9
IHRwbTJfcHJvYmUoY2hpcCk7CiAJdHBtX2NoaXBfc3RvcChjaGlwKTsKIAlpZiAocmMpCi0tIAoy
LjcuNAoK
